{"version":3,"file":"list-2fb97333-2583105.js","sources":["../node_modules/.pnpm/@vicons+fa@0.11.0/node_modules/@vicons/fa/es/Bookmark.js","../node_modules/.pnpm/@vicons+fa@0.11.0/node_modules/@vicons/fa/es/Heart.js","../node_modules/.pnpm/@vicons+fluent@0.11.0/node_modules/@vicons/fluent/es/EyeHide20Filled.js","../src/views/manage-notes/list.tsx"],"sourcesContent":["import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 384 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400L0 512z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'Bookmark',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'Heart',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 20 20'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'g',\n  {\n    fill: 'none'\n  },\n  [\n    /*#__PURE__*/ _createVNode('path', {\n      d: 'M2.854 2.146a.5.5 0 1 0-.708.708l3.5 3.498a8.097 8.097 0 0 0-3.366 5.046a.5.5 0 1 0 .979.204a7.09 7.09 0 0 1 3.108-4.528L7.95 8.656a3.5 3.5 0 1 0 4.884 4.884l4.313 4.314a.5.5 0 0 0 .708-.708l-15-15z',\n      fill: 'currentColor'\n    }),\n    /*#__PURE__*/ _createVNode('path', {\n      d: 'M10.124 8.003l3.363 3.363a3.5 3.5 0 0 0-3.363-3.363z',\n      fill: 'currentColor'\n    }),\n    /*#__PURE__*/ _createVNode('path', {\n      d: 'M7.531 5.41l.803.803A6.632 6.632 0 0 1 10 6c3.206 0 6.057 2.327 6.74 5.602a.5.5 0 1 0 .98-.204C16.943 7.673 13.693 5 10 5c-.855 0-1.687.143-2.469.41z',\n      fill: 'currentColor'\n    })\n  ],\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'EyeHide20Filled',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import Book from '@vicons/fa/es/Book'\nimport Bookmark from '@vicons/fa/es/Bookmark'\nimport Heart from '@vicons/fa/es/Heart'\nimport Add12Filled from '@vicons/fluent/es/Add12Filled'\nimport Delete16Regular from '@vicons/fluent/es/Delete16Regular'\nimport EyeHide20Filled from '@vicons/fluent/es/EyeHide20Filled'\nimport { Icon } from '@vicons/utils'\nimport { Table } from 'components/table'\nimport { EditColumn } from 'components/table/edit-column'\nimport { RelativeTime } from 'components/time/relative-time'\nimport { useTable } from 'hooks/use-table'\nimport { Pager } from 'models/base'\nimport { NoteModel } from 'models/note'\nimport {\n  NButton,\n  NEllipsis,\n  NPopconfirm,\n  NSpace,\n  useDialog,\n  useMessage,\n} from 'naive-ui'\nimport { TableColumns } from 'naive-ui/lib/data-table/src/interface'\nimport { defineComponent, onMounted, reactive, watch } from 'vue'\nimport { RouterLink, useRoute } from 'vue-router'\nimport { HeaderActionButton } from '../../components/button/rounded-button'\nimport { ContentLayout } from '../../layouts/content'\nimport { RESTManager } from '../../utils/rest'\n\nexport const ManageNoteListView = defineComponent({\n  name: 'NoteList',\n  setup() {\n    const { loading, checkedRowKeys, data, pager, sortProps, fetchDataFn } =\n      useTable<NoteModel>(\n        (data, pager) =>\n          async (page = route.query.page || 1, size = 20) => {\n            const response = await RESTManager.api.notes.get<{\n              data: NoteModel[]\n              pagination: Pager\n            }>({\n              params: {\n                page,\n                size,\n                select:\n                  'title _id id created modified mood weather hide secret hasMemory coordinates location count',\n                ...(sortProps.sortBy\n                  ? { sortBy: sortProps.sortBy, sortOrder: sortProps.sortOrder }\n                  : {}),\n              },\n            })\n            data.value = response.data\n            pager.value = response.pagination\n          },\n      )\n\n    const message = useMessage()\n    const dialog = useDialog()\n\n    const route = useRoute()\n    const fetchData = fetchDataFn\n    watch(\n      () => route.query.page,\n      async (n) => {\n        // @ts-expect-error\n        await fetchData(n)\n      },\n    )\n\n    onMounted(async () => {\n      await fetchData()\n    })\n\n    const DataTable = defineComponent({\n      setup() {\n        const columns = reactive<TableColumns<NoteModel>>([\n          {\n            type: 'selection',\n            options: ['none', 'all'],\n          },\n          {\n            title: '标题',\n            sortOrder: false,\n            sorter: 'default',\n            key: 'title',\n            width: 300,\n            render(row) {\n              return (\n                <RouterLink\n                  to={'/notes/edit?id=' + row.id}\n                  class=\"flex items-center space-x-2\"\n                >\n                  <span>{row.title}</span>\n                  {row.hide ||\n                  (row.secret && +new Date(row.secret) - +new Date() > 0) ? (\n                    <Icon color=\"#34495e\">\n                      <EyeHide20Filled />\n                    </Icon>\n                  ) : null}\n                  {row.hasMemory ? (\n                    <Icon color=\"#e74c3c\">\n                      <Bookmark />\n                    </Icon>\n                  ) : null}\n                </RouterLink>\n              )\n            },\n          },\n          {\n            title: '心情',\n            key: 'mood',\n            width: 100,\n            render(row, index) {\n              return (\n                <EditColumn\n                  initialValue={data.value[index].mood ?? ''}\n                  onSubmit={async (v) => {\n                    await RESTManager.api.notes(row.id).put({\n                      data: {\n                        mood: v,\n                      },\n                    })\n\n                    message.success('修改成功')\n                    data.value[index].mood = v\n                  }}\n                  placeholder=\"心情\"\n                />\n              )\n            },\n          },\n          {\n            title: '天气',\n            key: 'weather',\n            width: 100,\n            render(row, index) {\n              return (\n                <EditColumn\n                  initialValue={data.value[index].weather ?? ''}\n                  onSubmit={async (v) => {\n                    await RESTManager.api.notes(row.id).put({\n                      data: {\n                        weather: v,\n                      },\n                    })\n                    message.success('修改成功')\n                    data.value[index].weather = v\n                  }}\n                  placeholder=\"天气\"\n                />\n              )\n            },\n          },\n          {\n            title: '地点',\n            key: 'location',\n            width: 200,\n            render(row) {\n              const { coordinates, location } = row\n              if (!location) {\n                return null\n              } else {\n                return (\n                  <NEllipsis class=\"truncate max-w-[200px]\">\n                    {{\n                      tooltip() {\n                        return (\n                          <div class=\"\">\n                            <p>{location}</p>\n                            <p>\n                              {coordinates?.longitude}, {coordinates?.latitude}\n                            </p>\n                          </div>\n                        )\n                      },\n                      default() {\n                        return location\n                      },\n                    }}\n                  </NEllipsis>\n                )\n              }\n            },\n          },\n\n          {\n            title: () => (\n              <Icon>\n                <Book />\n              </Icon>\n            ),\n            key: 'count.read',\n            ellipsis: true,\n            render(row) {\n              return row.count?.read || 0\n            },\n          },\n          {\n            title: () => (\n              <Icon>\n                <Heart />\n              </Icon>\n            ),\n            ellipsis: true,\n            key: 'count.like',\n            render(row) {\n              return row.count?.like || 0\n            },\n          },\n\n          {\n            title: '创建于',\n            key: 'created',\n            sortOrder: 'descend',\n            sorter: 'default',\n            width: 200,\n            render(row) {\n              return <RelativeTime time={row.created} />\n            },\n          },\n          {\n            title: '修改于',\n            key: 'modified',\n            sorter: 'default',\n            sortOrder: false,\n            width: 200,\n            render(row) {\n              return <RelativeTime time={row.modified} />\n            },\n          },\n          {\n            title: '操作',\n            key: 'id',\n            width: 100,\n            fixed: 'right',\n            render(row) {\n              return (\n                <NSpace>\n                  <NPopconfirm\n                    positiveText={'取消'}\n                    negativeText=\"删除\"\n                    onNegativeClick={async () => {\n                      await RESTManager.api.notes(row.id).delete()\n                      message.success('删除成功')\n                      await fetchData(pager.value.currentPage)\n                    }}\n                  >\n                    {{\n                      trigger: () => (\n                        <NButton text type=\"error\" size=\"tiny\">\n                          移除\n                        </NButton>\n                      ),\n\n                      default: () => (\n                        <span style={{ maxWidth: '12rem' }}>\n                          确定要删除 {row.title} ?\n                        </span>\n                      ),\n                    }}\n                  </NPopconfirm>\n                </NSpace>\n              )\n            },\n          },\n        ])\n\n        return () => (\n          <Table\n            loading={loading.value}\n            columns={columns}\n            data={data}\n            onFetchData={fetchData}\n            pager={pager}\n            onUpdateCheckedRowKeys={(keys) => {\n              checkedRowKeys.value = keys\n            }}\n            onUpdateSorter={async (props) => {\n              sortProps.sortBy = props.sortBy\n              sortProps.sortOrder = props.sortOrder\n            }}\n          ></Table>\n        )\n      },\n    })\n\n    return () => {\n      return (\n        <ContentLayout>\n          {{\n            actions: () => (\n              <>\n                <HeaderActionButton\n                  variant=\"error\"\n                  disabled={checkedRowKeys.value.length == 0}\n                  onClick={() => {\n                    dialog.warning({\n                      title: '警告',\n                      content: '你确定要删除？',\n                      positiveText: '确定',\n                      negativeText: '不确定',\n                      onPositiveClick: async () => {\n                        for (const id of checkedRowKeys.value) {\n                          await RESTManager.api.notes(id as string).delete()\n                        }\n                        checkedRowKeys.value.length = 0\n                        message.success('删除成功')\n\n                        await fetchData()\n                      },\n                    })\n                  }}\n                  icon={<Delete16Regular />}\n                />\n                <HeaderActionButton to={'/notes/edit'} icon={<Add12Filled />} />\n              </>\n            ),\n            default: () => <DataTable />,\n          }}\n        </ContentLayout>\n      )\n    }\n  },\n})\n"],"names":["_hoisted_1","xmlns","viewBox","_hoisted_2","d","fill","defineComponent","name","render","_ctx","_cache","_openBlock","_createBlock","ManageNoteListView","setup","loading","checkedRowKeys","data","pager","sortProps","fetchDataFn","useTable","data2","pager2","async","page","route","query","size","response","RESTManager","api","notes","get","params","select","sortBy","sortOrder","value","pagination","message","useMessage","dialog","useDialog","useRoute","fetchData","n","DataTable","columns","reactive","type","options","title","sorter","key","width","row","RouterLink","to","id","class","hide","secret","Date","Icon","color","EyeHide20Filled","hasMemory","Bookmark","index","EditColumn","initialValue","mood","onSubmit","v","put","success","placeholder","weather","coordinates","location","NEllipsis","tooltip","longitude","latitude","default","Book","ellipsis","count","read","Heart","like","RelativeTime","time","created","modified","fixed","NSpace","NPopconfirm","positiveText","negativeText","onNegativeClick","delete","currentPage","trigger","NButton","text","style","maxWidth","Table","onFetchData","onUpdateCheckedRowKeys","keys","onUpdateSorter","props","ContentLayout","actions","HeaderActionButton","variant","disabled","length","onClick","warning","content","onPositiveClick","icon","Delete16Regular","Add12Filled"],"mappings":"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"}