import{A as t}from"./Add12Filled.js";import{D as e}from"./Delete16Regular.js";import{T as r}from"./index3.js";import{R as n}from"./relative-time.js";import{u as o}from"./use-table.js";import{R as a,p as i,d as l,a as s}from"./index.js";import{d as c,G as u,z as f,af as p,w as d,o as g,aT as h,h as v,Q as _,aV as m,A as y,B as w,aW as b,F as j}from"./vendor.js";import{H as x}from"./rounded-button.js";function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t){if(!("string"==typeof t||t instanceof String)){var e=q(t);throw null===t?e="null":"object"===e&&(e=t.constructor.name),new TypeError("Expected a string but received a ".concat(e))}}function F(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;for(var r in e)void 0===t[r]&&(t[r]=e[r]);return t}var z={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1};var R="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",S="(".concat(R,"[.]){3}").concat(R),$=new RegExp("^".concat(S,"$")),D="(?:[0-9a-fA-F]{1,4})",E=new RegExp("^("+"(?:".concat(D,":){7}(?:").concat(D,"|:)|")+"(?:".concat(D,":){6}(?:").concat(S,"|:").concat(D,"|:)|")+"(?:".concat(D,":){5}(?::").concat(S,"|(:").concat(D,"){1,2}|:)|")+"(?:".concat(D,":){4}(?:(:").concat(D,"){0,1}:").concat(S,"|(:").concat(D,"){1,3}|:)|")+"(?:".concat(D,":){3}(?:(:").concat(D,"){0,2}:").concat(S,"|(:").concat(D,"){1,4}|:)|")+"(?:".concat(D,":){2}(?:(:").concat(D,"){0,3}:").concat(S,"|(:").concat(D,"){1,5}|:)|")+"(?:".concat(D,":){1}(?:(:").concat(D,"){0,4}:").concat(S,"|(:").concat(D,"){1,6}|:)|")+"(?::((?::".concat(D,"){0,5}:").concat(S,"|(?::").concat(D,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");function T(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(k(t),!(e=String(e)))return T(t,4)||T(t,6);if("4"===e){if(!$.test(t))return!1;var r=t.split(".").sort((function(t,e){return t-e}));return r[3]<=255}return"6"===e&&!!E.test(t)}var A={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,validate_length:!0},C=/^\[([^\]]+)\](?::([0-9]+))?$/;function B(t,e){for(var r=0;r<e.length;r++){var n=e[r];if(t===n||(o=n,"[object RegExp]"===Object.prototype.toString.call(o)&&n.test(t)))return!0}var o;return!1}function O(t,e){if(k(t),!t||/[\s<>]/.test(t))return!1;if(0===t.indexOf("mailto:"))return!1;if((e=F(e,A)).validate_length&&t.length>=2083)return!1;var r,n,o,a,i,l,s,c;if(s=t.split("#"),t=s.shift(),s=t.split("?"),t=s.shift(),(s=t.split("://")).length>1){if(r=s.shift().toLowerCase(),e.require_valid_protocol&&-1===e.protocols.indexOf(r))return!1}else{if(e.require_protocol)return!1;if("//"===t.substr(0,2)){if(!e.allow_protocol_relative_urls)return!1;s[0]=t.substr(2)}}if(""===(t=s.join("://")))return!1;if(s=t.split("/"),""===(t=s.shift())&&!e.require_host)return!0;if((s=t.split("@")).length>1){if(e.disallow_auth)return!1;if(""===s[0]||":"===s[0].substr(0,1))return!1;if((n=s.shift()).indexOf(":")>=0&&n.split(":").length>2)return!1}l=null,c=null;var u=(a=s.join("@")).match(C);if(u?(o="",c=u[1],l=u[2]||null):(o=(s=a.split(":")).shift(),s.length&&(l=s.join(":"))),null!==l){if(i=parseInt(l,10),!/^[0-9]+$/.test(l)||i<=0||i>65535)return!1}else if(e.require_port)return!1;return!!(T(o)||function(t,e){k(t),(e=F(e,z)).allow_trailing_dot&&"."===t[t.length-1]&&(t=t.substring(0,t.length-1));var r=t.split("."),n=r[r.length-1];if(e.require_tld){if(r.length<2)return!1;if(!/^([a-z\u00a1-\uffff]{2,}|xn[a-z0-9-]{2,})$/i.test(n))return!1;if(/[\s\u2002-\u200B\u202F\u205F\u3000\uFEFF\uDB40\uDC20\u00A9\uFFFD]/.test(n))return!1}return!(!e.allow_numeric_tld&&/^\d+$/.test(n))&&r.every((function(t){return!(t.length>63||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(t)||/[\uff01-\uff5e]/.test(t)||/^-|-$/.test(t)||!e.allow_underscores&&/_/.test(t))}))}(o,e)||c&&T(c,6))&&(o=o||c,!(e.host_whitelist&&!B(o,e.host_whitelist))&&(!e.host_blacklist||!B(o,e.host_blacklist)))}const P=c({setup(q,k){const{checkedRowKeys:F,data:z,pager:R,sortProps:S,fetchDataFn:$}=o(((t,e)=>async(r=T.query.page||1,n=30)=>{const o=await a.api.projects.get({params:{page:r,size:n}});t.value=o.data,e.value=o.pagination})),D=u(),E=f(),T=p(),A=$;d((()=>T.query.page),(async t=>{await A(t)})),g((async()=>{await A()}));const C=c({setup(){const t=h([{type:"selection",options:["none","all"]},{title:"项目名称",key:"name",width:100,render(t){const e=[t.previewUrl,t.projectUrl,t.docUrl].filter(Boolean).find((t=>O(t,{require_protocol:!0})));return e?v("a",{href:e,target:"_blank",rel:"noreferrer"},t.name):v(_,null,t.name)}},{title:"项目描述",key:"description"},{title:"创建时间",key:"created",render:t=>i(t.created)},{title:"修改于",key:"created",render:t=>v(n,{time:t.created})},{title:"操作",fixed:"right",key:"id",width:130,render:t=>v(w,{wrap:!1},v(m,{to:{name:l.EditProject,query:{id:t.id}}},v(y,{text:!0,type:"primary",size:"tiny"},"编辑")),v(b,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await a.api.projects(t.id).delete(),D.success("删除成功"),await A(R.value.currentPage)}},{trigger:()=>v(y,{text:!0,type:"error",size:"tiny"},"移除"),default:()=>v("span",{style:{maxWidth:"12rem"}},"确定要删除项目 [",t.name,"] ?")}))}]);return()=>v(r,{columns:t,data:z,onFetchData:A,pager:R,onUpdateCheckedRowKeys:t=>{F.value=t}})}});return()=>v(s,null,{actions:()=>v(j,null,v(x,{variant:"error",disabled:0==F.value.length,onClick:()=>{E.warning({title:"警告",content:"你确定要删除？",positiveText:"确定",negativeText:"不确定",onPositiveClick:async()=>{for(const t of F.value)await a.api.projects(t).delete();F.value.length=0,D.success("删除成功"),await A()}})},icon:v(e,null)}),v(x,{to:"/projects/edit",icon:v(t,null)})),default:()=>v(C,null)})}});export{P as default};
