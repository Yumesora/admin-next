import{P as e}from"./Plus.js";import{H as t}from"./rounded-button.js";import{T as r}from"./index3.js";import{u as n}from"./use-table.js";import{R as o,d as a,a as i}from"./index.js";import{bx as l,bO as u,bP as c,bQ as d,bN as s,d as f,af as v,u as y,r as p,G as b,w as m,E as g,h as j,ba as O,U as P,b0 as w,b1 as h,y as _,aZ as S,B as x,A as M,o as I,bL as k,aW as K,bJ as C,bK as A,Y as N,Q as B,F as $,b4 as T}from"./vendor.js";import{v as V}from"./index4.js";var z,F,E,D;(F=z||(z={}))[F.Friend=0]="Friend",F[F.Collection=1]="Collection",(D=E||(E={}))[D.Pass=0]="Pass",D[D.Audit=1]="Audit";var R={},q={},U={};Object.defineProperty(U,"__esModule",{value:!0}),U.getSlot=void 0,U.getSlot=function(e,t="default",r=[]){const n=e.$slots[t];return void 0===n?r:n()};var H={};Object.defineProperty(H,"__esModule",{value:!0}),H.getVNodeChildren=void 0,H.getVNodeChildren=function(e,t="default",r=[]){const{children:n}=e;if(null!==n&&"object"==typeof n&&!Array.isArray(n)){const e=n[t];if("function"==typeof e)return e()}return r};var L={};Object.defineProperty(L,"__esModule",{value:!0}),L.keep=void 0,L.keep=function(e,t=[],r){const n={};return t.forEach((t=>{n[t]=e[t]})),Object.assign(n,r)};var Q={};Object.defineProperty(Q,"__esModule",{value:!0}),Q.omit=void 0,Q.omit=function(e,t=[],r){const n={};return Object.getOwnPropertyNames(e).forEach((r=>{t.includes(r)||(n[r]=e[r])})),Object.assign(n,r)};var W={};Object.defineProperty(W,"__esModule",{value:!0}),W.flatten=void 0;const G=V.exports;W.flatten=function e(t,r=!0,n=[]){return t.forEach((t=>{if(null!==t)if("object"==typeof t)if(Array.isArray(t))e(t,r,n);else if(t.type===G.Fragment){if(null===t.children)return;Array.isArray(t.children)&&e(t.children,r,n)}else t.type!==G.Comment&&n.push(t);else"string"!=typeof t&&"number"!=typeof t||n.push((0,G.createTextVNode)(String(t)))})),n};var J={};Object.defineProperty(J,"__esModule",{value:!0}),J.call=void 0,J.call=function e(t,...r){if(!Array.isArray(t))return t(...r);t.forEach((t=>e(t,...r)))};var Y={};Object.defineProperty(Y,"__esModule",{value:!0}),Y.keysOf=void 0,Y.keysOf=function(e){return Object.keys(e)};var Z={};Object.defineProperty(Z,"__esModule",{value:!0}),Z.render=void 0;const X=V.exports;Z.render=(e,...t)=>"function"==typeof e?e(...t):"string"==typeof e?(0,X.createTextVNode)(e):"number"==typeof e?(0,X.createTextVNode)(String(e)):null;var ee={},te={},re={};Object.defineProperty(re,"__esModule",{value:!0}),re.throwError=re.warn=re.warnOnce=void 0;const ne=new Set;re.warnOnce=function(e,t){const r=`[naive/${e}]: ${t}`;ne.has(r)||(ne.add(r),console.error(r))},re.warn=function(e,t){console.error(`[naive/${e}]: ${t}`)},re.throwError=function(e,t){throw new Error(`[naive/${e}]: ${t}`)};var oe={};Object.defineProperty(oe,"__esModule",{value:!0}),oe.smallerSize=oe.largerSize=void 0,oe.largerSize=function(e){switch(e){case"tiny":return"small";case"small":return"medium";case"medium":return"large";case"large":return"huge"}},oe.smallerSize=function(e){switch(e){case"small":return"tiny";case"medium":return"small";case"large":return"medium";case"huge":return"large"}};var ae={};Object.defineProperty(ae,"__esModule",{value:!0}),ae.getTitleAttribute=void 0,ae.getTitleAttribute=function(e){switch(typeof e){case"string":return e||void 0;case"number":return String(e);default:return}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getTitleAttribute=e.largerSize=e.smallerSize=e.throwError=e.warnOnce=e.warn=void 0;var t=re;Object.defineProperty(e,"warn",{enumerable:!0,get:function(){return t.warn}}),Object.defineProperty(e,"warnOnce",{enumerable:!0,get:function(){return t.warnOnce}}),Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return t.throwError}});var r=oe;Object.defineProperty(e,"smallerSize",{enumerable:!0,get:function(){return r.smallerSize}}),Object.defineProperty(e,"largerSize",{enumerable:!0,get:function(){return r.largerSize}});var n=ae;Object.defineProperty(e,"getTitleAttribute",{enumerable:!0,get:function(){return n.getTitleAttribute}})}(te),Object.defineProperty(ee,"__esModule",{value:!0}),ee.getFirstSlotVNode=void 0;const ie=W,le=te;ee.getFirstSlotVNode=function(e,t="default",r){const n=e[t];if(!n)return(0,le.warn)("getFirstSlotVNode",`slot[${t}] is empty`),null;const o=(0,ie.flatten)(n(r));return 1===o.length?o[0]:((0,le.warn)("getFirstSlotVNode",`slot[${t}] should have exactly one child`),null)};var ue={};Object.defineProperty(ue,"__esModule",{value:!0}),ue.createDataKey=void 0,ue.createDataKey=function(e){return"string"==typeof e?`s-${e}`:`n-${e}`};var ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.createRefSetter=void 0,ce.createRefSetter=function(e){return t=>{e.value=t?t.$el:null}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createRefSetter=e.createDataKey=e.getFirstSlotVNode=e.render=e.keysOf=e.call=e.flatten=e.omit=e.keep=e.getVNodeChildren=e.getSlot=void 0;var t=U;Object.defineProperty(e,"getSlot",{enumerable:!0,get:function(){return t.getSlot}});var r=H;Object.defineProperty(e,"getVNodeChildren",{enumerable:!0,get:function(){return r.getVNodeChildren}});var n=L;Object.defineProperty(e,"keep",{enumerable:!0,get:function(){return n.keep}});var o=Q;Object.defineProperty(e,"omit",{enumerable:!0,get:function(){return o.omit}});var a=W;Object.defineProperty(e,"flatten",{enumerable:!0,get:function(){return a.flatten}});var i=J;Object.defineProperty(e,"call",{enumerable:!0,get:function(){return i.call}});var l=Y;Object.defineProperty(e,"keysOf",{enumerable:!0,get:function(){return l.keysOf}});var u=Z;Object.defineProperty(e,"render",{enumerable:!0,get:function(){return u.render}});var c=ee;Object.defineProperty(e,"getFirstSlotVNode",{enumerable:!0,get:function(){return c.getFirstSlotVNode}});var d=ue;Object.defineProperty(e,"createDataKey",{enumerable:!0,get:function(){return d.createDataKey}});var s=ce;Object.defineProperty(e,"createRefSetter",{enumerable:!0,get:function(){return s.createRefSetter}})}(q);var de={},se={};Object.defineProperty(se,"__esModule",{value:!0});const fe=/^(\d|\.)+$/,ve=/(\d|\.)+/;se.default=function(e,{c:t=1,offset:r=0,attachPx:n=!0}={}){if("number"==typeof e){const n=(e+r)*t;return 0===n?"0":`${n}px`}if("string"==typeof e){if(fe.test(e)){const o=(Number(e)+r)*t;return n?0===o?"0":`${o}px`:`${o}`}{const n=ve.exec(e);return n?e.replace(ve,String((Number(n[0])+r)*t)):e}}return e},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLength=void 0;var t=se;Object.defineProperty(e,"formatLength",{enumerable:!0,get:function(){return t.default}})}(de);var ye={},pe=l(u),be=l(c),me={};function ge(e,t){return e+("default"===t?"":t.replace(/^[a-z]/,(e=>e.toUpperCase())))}Object.defineProperty(me,"__esModule",{value:!0}),me.createKey=void 0,me.createKey=ge,ge("abc","def"),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createKey=e.find=e.namespace=e.prefix=e.asModal=e.insidePopover=e.insideModal=e.insideFormItem=e.cCB=e.cNotM=e.cM=e.cE=e.cB=e.c=void 0;const t=pe,r=be;e.namespace="n";const n=".n-";e.prefix=n;const o=(0,t.default)(),a=(0,r.default)({blockPrefix:n,elementPrefix:"__",modifierPrefix:"--"});o.use(a);const{c:i,find:l}=o;e.c=i,e.find=l;const{cB:u,cE:c,cM:d,cNotM:s}=a;e.cB=u,e.cE=c,e.cM=d,e.cNotM=s,e.insideFormItem=function(e,t){return null===e?t:i([({props:{bPrefix:r}})=>i(`${r||n}form-item`,[i(`${r||n}form-item-blank`,[i(`&${r||n}form-item-blank--${e}`,[t])])])])},e.insideModal=function(e){return i((({props:{bPrefix:e}})=>`${e||n}modal, ${e||n}drawer`),[e])},e.insidePopover=function(e){return i((({props:{bPrefix:e}})=>`${e||n}popover:not(${e||n}tooltip)`),[e])},e.asModal=function(e){return i((({props:{bPrefix:e}})=>`&${e||n}modal`),e)};e.cCB=(...e)=>i(">",[u(...e)]);var f=me;Object.defineProperty(e,"createKey",{enumerable:!0,get:function(){return f.createKey}})}(ye);var je={},Oe={},Pe=l(d),we={};Object.defineProperty(we,"__esModule",{value:!0}),we.modalInjectionKey=we.modalBodyInjectionKey=void 0,we.modalBodyInjectionKey=Symbol("modalBody"),we.modalInjectionKey=Symbol("modal");var he={};Object.defineProperty(he,"__esModule",{value:!0}),he.drawerInjectionKey=he.drawerBodyInjectionKey=void 0,he.drawerBodyInjectionKey=Symbol("drawerBody"),he.drawerInjectionKey=Symbol("drawer");var _e={};Object.defineProperty(_e,"__esModule",{value:!0}),_e.popoverBodyInjectionKey=void 0,_e.popoverBodyInjectionKey=Symbol("popoverBodyInjection");var Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.internalSelectionMenuBodyInjectionKey=Se.internalSelectionMenuInjectionKey=void 0,Se.internalSelectionMenuInjectionKey=Symbol("internal-select-menu"),Se.internalSelectionMenuBodyInjectionKey=Symbol("internal-select-menu-body"),Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.useAdjustedTo=void 0;const xe=Pe,Me=V.exports,Ie=we,ke=he,Ke=_e,Ce=Se;function Ae(e){const t=(0,Me.inject)(Ie.modalBodyInjectionKey,null),r=(0,Me.inject)(ke.drawerBodyInjectionKey,null),n=(0,Me.inject)(Ke.popoverBodyInjectionKey,null),o=(0,Me.inject)(Ce.internalSelectionMenuBodyInjectionKey,null);return(0,xe.useMemo)((()=>{var a;const{to:i}=e;return void 0!==i?!1===i?"__disabled__":!0===i?"body":i:(null==t?void 0:t.value)?null!==(a=t.value.$el)&&void 0!==a?a:t.value:(null==r?void 0:r.value)?r.value:(null==n?void 0:n.value)?n.value:(null==o?void 0:o.value)?o.value:null!=i?i:"body"}))}Oe.useAdjustedTo=Ae,Ae.tdkey="__disabled__",Ae.propTo={type:[String,Object,Boolean],default:void 0};var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.useHoudini=void 0;const Be=V.exports;let $e=!1;Ne.useHoudini=function(){(0,Be.onBeforeMount)((()=>{var e;$e||($e=!0,(null===(e=null===window||void 0===window?void 0:window.CSS)||void 0===e?void 0:e.registerProperty)&&(CSS.registerProperty({name:"--color-start",syntax:"<color>",inherits:!1,initialValue:"#0000"}),CSS.registerProperty({name:"--color-end",syntax:"<color>",inherits:!1,initialValue:"#0000"})))}))},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useHoudini=e.useAdjustedTo=e.useDeferredTrue=e.useInjectionElementCollection=e.useInjectionCollection=e.useInjectionInstanceCollection=void 0;const t=V.exports;e.useInjectionInstanceCollection=function(e,r,n){var o;const a=(0,t.inject)(e,null);if(null===a)return;const i=null===(o=(0,t.getCurrentInstance)())||void 0===o?void 0:o.proxy;function l(e,t){const n=a[r];void 0!==t&&function(e,t){e[t]||(e[t]=[]);e[t].splice(e[t].findIndex((e=>e===i)),1)}(n,t),void 0!==e&&function(e,t){e[t]||(e[t]=[]);~e[t].findIndex((e=>e===i))||e[t].push(i)}(n,e)}(0,t.watch)(n,l),l(n.value),(0,t.onBeforeUnmount)((()=>{l(void 0,n.value)}))},e.useInjectionCollection=function(e,r,n){const o=(0,t.inject)(e,null);null!==o&&(r in o||(o[r]=[]),o[r].push(n.value),(0,t.watch)(n,((e,t)=>{const n=o[r],a=n.findIndex((e=>e===t));~a&&n.splice(a,1),n.push(e)})),(0,t.onBeforeUnmount)((()=>{const e=o[r],t=e.findIndex((e=>e===n.value));~t&&e.splice(t,1)})))},e.useInjectionElementCollection=function(e,r,n){const o=(0,t.inject)(e,null);null!==o&&(r in o||(o[r]=[]),(0,t.onMounted)((()=>{const e=n();e&&o[r].push(e)})),(0,t.onBeforeUnmount)((()=>{const e=o[r],t=n(),a=e.findIndex((e=>e===t));~a&&e.splice(a,1)})))},e.useDeferredTrue=function(e,r,n){if(!r)return e;const o=(0,t.ref)(e.value);let a=null;return(0,t.watch)(e,(e=>{null!==a&&window.clearTimeout(a),!0===e?n&&!n.value?o.value=!0:a=window.setTimeout((()=>{o.value=!0}),r):o.value=!1})),o};var r=Oe;Object.defineProperty(e,"useAdjustedTo",{enumerable:!0,get:function(){return r.useAdjustedTo}});var n=Ne;Object.defineProperty(e,"useHoudini",{enumerable:!0,get:function(){return n.useHoudini}})}(je),function(e){var t=s&&s.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=s&&s.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.createKey=e.formatLength=e.getTitleAttribute=e.largerSize=e.smallerSize=e.throwError=e.warnOnce=e.warn=e.createRefSetter=e.createDataKey=e.getFirstSlotVNode=e.render=e.keysOf=e.getVNodeChildren=e.getSlot=e.flatten=e.omit=e.keep=e.call=void 0;var n=q;Object.defineProperty(e,"call",{enumerable:!0,get:function(){return n.call}}),Object.defineProperty(e,"keep",{enumerable:!0,get:function(){return n.keep}}),Object.defineProperty(e,"omit",{enumerable:!0,get:function(){return n.omit}}),Object.defineProperty(e,"flatten",{enumerable:!0,get:function(){return n.flatten}}),Object.defineProperty(e,"getSlot",{enumerable:!0,get:function(){return n.getSlot}}),Object.defineProperty(e,"getVNodeChildren",{enumerable:!0,get:function(){return n.getVNodeChildren}}),Object.defineProperty(e,"keysOf",{enumerable:!0,get:function(){return n.keysOf}}),Object.defineProperty(e,"render",{enumerable:!0,get:function(){return n.render}}),Object.defineProperty(e,"getFirstSlotVNode",{enumerable:!0,get:function(){return n.getFirstSlotVNode}}),Object.defineProperty(e,"createDataKey",{enumerable:!0,get:function(){return n.createDataKey}}),Object.defineProperty(e,"createRefSetter",{enumerable:!0,get:function(){return n.createRefSetter}});var o=te;Object.defineProperty(e,"warn",{enumerable:!0,get:function(){return o.warn}}),Object.defineProperty(e,"warnOnce",{enumerable:!0,get:function(){return o.warnOnce}}),Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return o.throwError}}),Object.defineProperty(e,"smallerSize",{enumerable:!0,get:function(){return o.smallerSize}}),Object.defineProperty(e,"largerSize",{enumerable:!0,get:function(){return o.largerSize}}),Object.defineProperty(e,"getTitleAttribute",{enumerable:!0,get:function(){return o.getTitleAttribute}});var a=de;Object.defineProperty(e,"formatLength",{enumerable:!0,get:function(){return a.formatLength}});var i=ye;Object.defineProperty(e,"createKey",{enumerable:!0,get:function(){return i.createKey}}),r(je,e)}(R);var Te=f({setup(){var l;const u=v(),c=y(),d=p(null!=(l=u.query.state)?l:E.Pass),{data:s,checkedRowKeys:V,fetchDataFn:F,pager:D,loading:q}=n(((e,t)=>async(r=u.query.page||1,n=50,a=(e=>null!=(e=u.query.state)?e:E.Pass)())=>{const i=await o.api.links.get({params:{page:r,size:n,state:0|a}});e.value=i.data,t.value=i.pagination})),U=b(),H=()=>({avatar:"",name:"",type:z.Friend,url:"",id:null,description:""}),L=p(!1),Q=p(H());m((()=>u.query.state),(async e=>{await F()})),m((()=>u.query.page),(async e=>{await F()}),{immediate:!0});const W=p(0);g((()=>{(async()=>{const e=await o.api.links.state.get();W.value=e.audit})()}));const G=async()=>{const e=Q.value.id;if(Q.value.id,e){await o.api.links(e).put({data:R.omit(Q.value,["id"])});const t=s.value.findIndex((t=>t.id==e));s.value[t]={...s.value[t],...T(Q.value)}}else{const{data:e}=await o.api.links.post({data:{...Q.value}});s.value.unshift(e)}U.success("操作成功"),Q.value=H(),L.value=!1};return()=>j(i,{actionsElement:j($,null,j(t,{icon:j(e,null),variant:"primary",onClick:()=>{Q.value=H(),L.value=!0}}))},j(C,{size:"medium",value:d.value,onUpdateValue:e=>{d.value=e,c.replace({name:a.Friend,query:{state:e}})}},j(A,{name:E.Pass,tab:"朋友们"},j("div",{class:""})),j(A,{name:E.Audit,tab:()=>j(N,{value:W.value,processing:!0},j(B,null,"待审核"))},j("div",{class:""}))),j(r,{loading:q.value,data:s,nTableProps:{maxHeight:"calc(100vh - 22rem)"},columns:[{title:"头像",key:"avatar",render(e){const t=f((()=>{const t=p(!e.avatar);return I((()=>{if(e.avatar){const r=new Image;r.src=e.avatar,r.onload=e=>{t.value=!0}}})),()=>e.avatar&&t.value?j(k,{src:e.avatar,round:!0}):j(k,{round:!0},e.name.charAt(0))}));return j(t,null)}},{title:"名称",key:"name"},{title:"类型",key:"type",render:e=>["朋友","收藏"][0|e.type]},{title:"网址",key:"url",render:e=>j("a",{target:"_blank",href:e.url,rel:"noreferrer"},e.url)},{title:"描述",key:"description"},{title:"操作",fixed:"right",key:"id",render:e=>j(x,{wrap:!1},e.state==E.Audit&&j(M,{text:!0,size:"tiny",type:"success",onClick:async()=>{await o.api.links.audit(e.id).patch(),U.success("通过了来自"+e.name+"的友链邀请");const t=s.value.findIndex((t=>t.id==e.id));s.value.splice(t,1),W.value--}},"通过"),j(M,{text:!0,size:"tiny",type:"info",onClick:t=>{L.value=!0,Q.value={...e}}},"编辑"),j(K,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await o.api.links(e.id).delete(),U.success("删除成功"),await F(D.value.currentPage),e.state==E.Audit&&W.value--}},{trigger:()=>j(M,{text:!0,type:"error",size:"tiny"},"移除"),default:()=>j("span",{style:{maxWidth:"12rem"}},"确定要删除友链 ",e.name," ?")}))}],onFetchData:F,pager:D}),j(O,{show:L.value,onUpdateShow:e=>{L.value=e}},j(P,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:Q.value.id?"编辑: "+Q.value.name:"新增"},j(w,null,j(h,{label:"名字",required:!0},j(_,{autofocus:!0,value:Q.value.name,onInput:e=>{Q.value.name=e}})),j(h,{label:"头像"},j(_,{autofocus:!0,value:Q.value.avatar,onInput:e=>{Q.value.avatar=e}})),j(h,{label:"网址",required:!0},j(_,{autofocus:!0,value:Q.value.url,onInput:e=>{Q.value.url=e}})),j(h,{label:"描述"},j(_,{autofocus:!0,value:Q.value.description,onInput:e=>{Q.value.description=e}})),j(h,{label:"类型"},j(S,{placeholder:"选择类型",options:[{label:"朋友",value:z.Friend},{label:"收藏",value:z.Collection}],value:Q.value.type,onUpdateValue:e=>{Q.value.type=0|e}}))),j("div",{class:"text-right"},j(x,{size:12,align:"center",inline:!0},j(M,{type:"success",onClick:G,round:!0},"确定"),j(M,{onClick:()=>{L.value=!1,Q.value=H()},round:!0},"取消"))))))}});export{Te as default};
