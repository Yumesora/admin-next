import{P as Ce}from"./Plus.js";import{H as $e}from"./rounded-button.js";import{T as Me}from"./index3.js";import{u as Fe}from"./use-table.js";import{R as w,d as Be,a as Ie}from"./index.js";import{bx as ne,bO as Ae,bP as Ne,bQ as Ee,bN as K,d as ce,af as Te,u as ke,r as B,G as Ke,w as de,E as Ve,h as l,ba as De,U as ze,b0 as Re,b1 as I,y as V,aZ as qe,B as se,A,o as He,bL as re,aW as Ue,bJ as Le,bK as fe,Y as Ge,Q as Qe,F as We,b4 as Je}from"./vendor.js";import{v as N}from"./index4.js";var E;(function(e){e[e.Friend=0]="Friend",e[e.Collection=1]="Collection"})(E||(E={}));var S;(function(e){e[e.Pass=0]="Pass",e[e.Audit=1]="Audit"})(S||(S={}));var ve={},me={},D={};Object.defineProperty(D,"__esModule",{value:!0});D.getSlot=void 0;function Ye(e,t="default",i=[]){const u=e.$slots[t];return u===void 0?i:u()}D.getSlot=Ye;var z={};Object.defineProperty(z,"__esModule",{value:!0});z.getVNodeChildren=void 0;function Ze(e,t="default",i=[]){const{children:n}=e;if(n!==null&&typeof n=="object"&&!Array.isArray(n)){const u=n[t];if(typeof u=="function")return u()}return i}z.getVNodeChildren=Ze;var R={};Object.defineProperty(R,"__esModule",{value:!0});R.keep=void 0;function Xe(e,t=[],i){const n={};return t.forEach(u=>{n[u]=e[u]}),Object.assign(n,i)}R.keep=Xe;var q={};Object.defineProperty(q,"__esModule",{value:!0});q.omit=void 0;function xe(e,t=[],i){const n={};return Object.getOwnPropertyNames(e).forEach(v=>{t.includes(v)||(n[v]=e[v])}),Object.assign(n,i)}q.omit=xe;var T={};Object.defineProperty(T,"__esModule",{value:!0});T.flatten=void 0;const ue=N.exports;function ae(e,t=!0,i=[]){return e.forEach(n=>{if(n!==null){if(typeof n!="object"){(typeof n=="string"||typeof n=="number")&&i.push((0,ue.createTextVNode)(String(n)));return}if(Array.isArray(n)){ae(n,t,i);return}if(n.type===ue.Fragment){if(n.children===null)return;Array.isArray(n.children)&&ae(n.children,t,i)}else n.type!==ue.Comment&&i.push(n)}}),i}T.flatten=ae;var H={};Object.defineProperty(H,"__esModule",{value:!0});H.call=void 0;function ye(e,...t){if(Array.isArray(e))e.forEach(i=>ye(i,...t));else return e(...t)}H.call=ye;var U={};Object.defineProperty(U,"__esModule",{value:!0});U.keysOf=void 0;function et(e){return Object.keys(e)}U.keysOf=et;var L={};Object.defineProperty(L,"__esModule",{value:!0});L.render=void 0;const be=N.exports,tt=(e,...t)=>typeof e=="function"?e(...t):typeof e=="string"?(0,be.createTextVNode)(e):typeof e=="number"?(0,be.createTextVNode)(String(e)):null;L.render=tt;var G={},ie={},h={};Object.defineProperty(h,"__esModule",{value:!0});h.throwError=h.warn=h.warnOnce=void 0;const ge=new Set;function nt(e,t){const i=`[naive/${e}]: ${t}`;ge.has(i)||(ge.add(i),console.error(i))}h.warnOnce=nt;function rt(e,t){console.error(`[naive/${e}]: ${t}`)}h.warn=rt;function ut(e,t){throw new Error(`[naive/${e}]: ${t}`)}h.throwError=ut;var C={};Object.defineProperty(C,"__esModule",{value:!0});C.smallerSize=C.largerSize=void 0;function at(e){switch(e){case"tiny":return"small";case"small":return"medium";case"medium":return"large";case"large":return"huge"}}C.largerSize=at;function it(e){switch(e){case"small":return"tiny";case"medium":return"small";case"large":return"medium";case"huge":return"large"}}C.smallerSize=it;var Q={};Object.defineProperty(Q,"__esModule",{value:!0});Q.getTitleAttribute=void 0;function ot(e){switch(typeof e){case"string":return e||void 0;case"number":return String(e);default:return}}Q.getTitleAttribute=ot;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getTitleAttribute=e.largerSize=e.smallerSize=e.throwError=e.warnOnce=e.warn=void 0;var t=h;Object.defineProperty(e,"warn",{enumerable:!0,get:function(){return t.warn}}),Object.defineProperty(e,"warnOnce",{enumerable:!0,get:function(){return t.warnOnce}}),Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return t.throwError}});var i=C;Object.defineProperty(e,"smallerSize",{enumerable:!0,get:function(){return i.smallerSize}}),Object.defineProperty(e,"largerSize",{enumerable:!0,get:function(){return i.largerSize}});var n=Q;Object.defineProperty(e,"getTitleAttribute",{enumerable:!0,get:function(){return n.getTitleAttribute}})})(ie);Object.defineProperty(G,"__esModule",{value:!0});G.getFirstSlotVNode=void 0;const lt=T,_e=ie;function ct(e,t="default",i=void 0){const n=e[t];if(!n)return(0,_e.warn)("getFirstSlotVNode",`slot[${t}] is empty`),null;const u=(0,lt.flatten)(n(i));return u.length===1?u[0]:((0,_e.warn)("getFirstSlotVNode",`slot[${t}] should have exactly one child`),null)}G.getFirstSlotVNode=ct;var W={};Object.defineProperty(W,"__esModule",{value:!0});W.createDataKey=void 0;function dt(e){return typeof e=="string"?`s-${e}`:`n-${e}`}W.createDataKey=dt;var J={};Object.defineProperty(J,"__esModule",{value:!0});J.createRefSetter=void 0;function st(e){return t=>{t?e.value=t.$el:e.value=null}}J.createRefSetter=st;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createRefSetter=e.createDataKey=e.getFirstSlotVNode=e.render=e.keysOf=e.call=e.flatten=e.omit=e.keep=e.getVNodeChildren=e.getSlot=void 0;var t=D;Object.defineProperty(e,"getSlot",{enumerable:!0,get:function(){return t.getSlot}});var i=z;Object.defineProperty(e,"getVNodeChildren",{enumerable:!0,get:function(){return i.getVNodeChildren}});var n=R;Object.defineProperty(e,"keep",{enumerable:!0,get:function(){return n.keep}});var u=q;Object.defineProperty(e,"omit",{enumerable:!0,get:function(){return u.omit}});var v=T;Object.defineProperty(e,"flatten",{enumerable:!0,get:function(){return v.flatten}});var m=H;Object.defineProperty(e,"call",{enumerable:!0,get:function(){return m.call}});var j=U;Object.defineProperty(e,"keysOf",{enumerable:!0,get:function(){return j.keysOf}});var d=L;Object.defineProperty(e,"render",{enumerable:!0,get:function(){return d.render}});var o=G;Object.defineProperty(e,"getFirstSlotVNode",{enumerable:!0,get:function(){return o.getFirstSlotVNode}});var c=W;Object.defineProperty(e,"createDataKey",{enumerable:!0,get:function(){return c.createDataKey}});var a=J;Object.defineProperty(e,"createRefSetter",{enumerable:!0,get:function(){return a.createRefSetter}})})(me);var je={},oe={};Object.defineProperty(oe,"__esModule",{value:!0});const ft=/^(\d|\.)+$/,pe=/(\d|\.)+/;function vt(e,{c:t=1,offset:i=0,attachPx:n=!0}={}){if(typeof e=="number"){const u=(e+i)*t;return u===0?"0":`${u}px`}else if(typeof e=="string")if(ft.test(e)){const u=(Number(e)+i)*t;return n?u===0?"0":`${u}px`:`${u}`}else{const u=pe.exec(e);return u?e.replace(pe,String((Number(u[0])+i)*t)):e}return e}oe.default=vt;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLength=void 0;var t=oe;Object.defineProperty(e,"formatLength",{enumerable:!0,get:function(){return t.default}})})(je);var Oe={},mt=ne(Ae),yt=ne(Ne),Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.createKey=void 0;function Pe(e,t){return e+(t==="default"?"":t.replace(/^[a-z]/,i=>i.toUpperCase()))}Y.createKey=Pe;Pe("abc","def");(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createKey=e.find=e.namespace=e.prefix=e.asModal=e.insidePopover=e.insideModal=e.insideFormItem=e.cCB=e.cNotM=e.cM=e.cE=e.cB=e.c=void 0;const t=mt,i=yt,n="n";e.namespace=n;const u=`.${n}-`;e.prefix=u;const v="__",m="--",j=(0,t.default)(),d=(0,i.default)({blockPrefix:u,elementPrefix:v,modifierPrefix:m});j.use(d);const{c:o,find:c}=j;e.c=o,e.find=c;const{cB:a,cE:s,cM:g,cNotM:_}=d;e.cB=a,e.cE=s,e.cM=g,e.cNotM=_;function r(O,P){return O===null?P:o([({props:{bPrefix:te}})=>o(`${te||u}form-item`,[o(`${te||u}form-item-blank`,[o(`&${te||u}form-item-blank${m}${O}`,[P])])])])}e.insideFormItem=r;function b(O){return o(({props:{bPrefix:P}})=>`${P||u}modal, ${P||u}drawer`,[O])}e.insideModal=b;function f(O){return o(({props:{bPrefix:P}})=>`${P||u}popover:not(${P||u}tooltip)`,[O])}e.insidePopover=f;function y(O){return o(({props:{bPrefix:P}})=>`&${P||u}modal`,O)}e.asModal=y;const p=(...O)=>o(">",[a(...O)]);e.cCB=p;var k=Y;Object.defineProperty(e,"createKey",{enumerable:!0,get:function(){return k.createKey}})})(Oe);var Se={},Z={},bt=ne(Ee),$={};Object.defineProperty($,"__esModule",{value:!0});$.modalInjectionKey=$.modalBodyInjectionKey=void 0;$.modalBodyInjectionKey=Symbol("modalBody");$.modalInjectionKey=Symbol("modal");var M={};Object.defineProperty(M,"__esModule",{value:!0});M.drawerInjectionKey=M.drawerBodyInjectionKey=void 0;M.drawerBodyInjectionKey=Symbol("drawerBody");M.drawerInjectionKey=Symbol("drawer");var X={};Object.defineProperty(X,"__esModule",{value:!0});X.popoverBodyInjectionKey=void 0;X.popoverBodyInjectionKey=Symbol("popoverBodyInjection");var F={};Object.defineProperty(F,"__esModule",{value:!0});F.internalSelectionMenuBodyInjectionKey=F.internalSelectionMenuInjectionKey=void 0;F.internalSelectionMenuInjectionKey=Symbol("internal-select-menu");F.internalSelectionMenuBodyInjectionKey=Symbol("internal-select-menu-body");Object.defineProperty(Z,"__esModule",{value:!0});Z.useAdjustedTo=void 0;const gt=bt,x=N.exports,_t=$,jt=M,pt=X,Ot=F,he="__disabled__";function le(e){const t=(0,x.inject)(_t.modalBodyInjectionKey,null),i=(0,x.inject)(jt.drawerBodyInjectionKey,null),n=(0,x.inject)(pt.popoverBodyInjectionKey,null),u=(0,x.inject)(Ot.internalSelectionMenuBodyInjectionKey,null);return(0,gt.useMemo)(()=>{var v;const{to:m}=e;return m!==void 0?m===!1?he:m===!0?"body":m:(t==null?void 0:t.value)?(v=t.value.$el)!==null&&v!==void 0?v:t.value:(i==null?void 0:i.value)?i.value:(n==null?void 0:n.value)?n.value:(u==null?void 0:u.value)?u.value:m??"body"})}Z.useAdjustedTo=le;le.tdkey=he;le.propTo={type:[String,Object,Boolean],default:void 0};var ee={};Object.defineProperty(ee,"__esModule",{value:!0});ee.useHoudini=void 0;const Pt=N.exports;let we=!1;function St(){(0,Pt.onBeforeMount)(()=>{var e;we||(we=!0,((e=window==null?void 0:window.CSS)===null||e===void 0?void 0:e.registerProperty)&&(CSS.registerProperty({name:"--color-start",syntax:"<color>",inherits:!1,initialValue:"#0000"}),CSS.registerProperty({name:"--color-end",syntax:"<color>",inherits:!1,initialValue:"#0000"})))})}ee.useHoudini=St;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useHoudini=e.useAdjustedTo=e.useDeferredTrue=e.useInjectionElementCollection=e.useInjectionCollection=e.useInjectionInstanceCollection=void 0;const t=N.exports;function i(d,o,c){var a;const s=(0,t.inject)(d,null);if(s===null)return;const g=(a=(0,t.getCurrentInstance)())===null||a===void 0?void 0:a.proxy;(0,t.watch)(c,_),_(c.value),(0,t.onBeforeUnmount)(()=>{_(void 0,c.value)});function _(f,y){const p=s[o];y!==void 0&&r(p,y),f!==void 0&&b(p,f)}function r(f,y){f[y]||(f[y]=[]),f[y].splice(f[y].findIndex(p=>p===g),1)}function b(f,y){f[y]||(f[y]=[]),~f[y].findIndex(p=>p===g)||f[y].push(g)}}e.useInjectionInstanceCollection=i;function n(d,o,c){const a=(0,t.inject)(d,null);a!==null&&(o in a||(a[o]=[]),a[o].push(c.value),(0,t.watch)(c,(s,g)=>{const _=a[o],r=_.findIndex(b=>b===g);~r&&_.splice(r,1),_.push(s)}),(0,t.onBeforeUnmount)(()=>{const s=a[o],g=s.findIndex(_=>_===c.value);~g&&s.splice(g,1)}))}e.useInjectionCollection=n;function u(d,o,c){const a=(0,t.inject)(d,null);a!==null&&(o in a||(a[o]=[]),(0,t.onMounted)(()=>{const s=c();!s||a[o].push(s)}),(0,t.onBeforeUnmount)(()=>{const s=a[o],g=c(),_=s.findIndex(r=>r===g);~_&&s.splice(_,1)}))}e.useInjectionElementCollection=u;function v(d,o,c){if(!o)return d;const a=(0,t.ref)(d.value);let s=null;return(0,t.watch)(d,g=>{s!==null&&window.clearTimeout(s),g===!0?c&&!c.value?a.value=!0:s=window.setTimeout(()=>{a.value=!0},o):a.value=!1}),a}e.useDeferredTrue=v;var m=Z;Object.defineProperty(e,"useAdjustedTo",{enumerable:!0,get:function(){return m.useAdjustedTo}});var j=ee;Object.defineProperty(e,"useHoudini",{enumerable:!0,get:function(){return j.useHoudini}})})(Se);(function(e){var t=K&&K.__createBinding||(Object.create?function(j,d,o,c){c===void 0&&(c=o),Object.defineProperty(j,c,{enumerable:!0,get:function(){return d[o]}})}:function(j,d,o,c){c===void 0&&(c=o),j[c]=d[o]}),i=K&&K.__exportStar||function(j,d){for(var o in j)o!=="default"&&!Object.prototype.hasOwnProperty.call(d,o)&&t(d,j,o)};Object.defineProperty(e,"__esModule",{value:!0}),e.createKey=e.formatLength=e.getTitleAttribute=e.largerSize=e.smallerSize=e.throwError=e.warnOnce=e.warn=e.createRefSetter=e.createDataKey=e.getFirstSlotVNode=e.render=e.keysOf=e.getVNodeChildren=e.getSlot=e.flatten=e.omit=e.keep=e.call=void 0;var n=me;Object.defineProperty(e,"call",{enumerable:!0,get:function(){return n.call}}),Object.defineProperty(e,"keep",{enumerable:!0,get:function(){return n.keep}}),Object.defineProperty(e,"omit",{enumerable:!0,get:function(){return n.omit}}),Object.defineProperty(e,"flatten",{enumerable:!0,get:function(){return n.flatten}}),Object.defineProperty(e,"getSlot",{enumerable:!0,get:function(){return n.getSlot}}),Object.defineProperty(e,"getVNodeChildren",{enumerable:!0,get:function(){return n.getVNodeChildren}}),Object.defineProperty(e,"keysOf",{enumerable:!0,get:function(){return n.keysOf}}),Object.defineProperty(e,"render",{enumerable:!0,get:function(){return n.render}}),Object.defineProperty(e,"getFirstSlotVNode",{enumerable:!0,get:function(){return n.getFirstSlotVNode}}),Object.defineProperty(e,"createDataKey",{enumerable:!0,get:function(){return n.createDataKey}}),Object.defineProperty(e,"createRefSetter",{enumerable:!0,get:function(){return n.createRefSetter}});var u=ie;Object.defineProperty(e,"warn",{enumerable:!0,get:function(){return u.warn}}),Object.defineProperty(e,"warnOnce",{enumerable:!0,get:function(){return u.warnOnce}}),Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return u.throwError}}),Object.defineProperty(e,"smallerSize",{enumerable:!0,get:function(){return u.smallerSize}}),Object.defineProperty(e,"largerSize",{enumerable:!0,get:function(){return u.largerSize}}),Object.defineProperty(e,"getTitleAttribute",{enumerable:!0,get:function(){return u.getTitleAttribute}});var v=je;Object.defineProperty(e,"formatLength",{enumerable:!0,get:function(){return v.formatLength}});var m=Oe;Object.defineProperty(e,"createKey",{enumerable:!0,get:function(){return m.createKey}}),i(Se,e)})(ve);var It=ce({setup(){const e=Te(),t=ke(),i=B(e.query.state??S.Pass),{data:n,checkedRowKeys:u,fetchDataFn:v,pager:m,loading:j}=Fe((r,b)=>async(f=e.query.page||1,y=50,p=e.query.state??S.Pass)=>{const k=await w.api.links.get({params:{page:f,size:y,state:p|0}});r.value=k.data,b.value=k.pagination}),d=Ke(),o=()=>({avatar:"",name:"",type:E.Friend,url:"",id:null,description:""}),c=B(!1),a=B(o());de(()=>e.query.state,async r=>{await v()}),de(()=>e.query.page,async r=>{await v()},{immediate:!0});const s=B(0),g=async()=>{const r=await w.api.links.state.get();s.value=r.audit};Ve(()=>{g()});const _=async()=>{const r=a.value.id;if(a.value.id,r){await w.api.links(r).put({data:ve.omit(a.value,["id"])});const b=n.value.findIndex(f=>f.id==r);n.value[b]={...n.value[b],...Je(a.value)}}else{const{data:b}=await w.api.links.post({data:{...a.value}});n.value.unshift(b)}d.success("\u64CD\u4F5C\u6210\u529F"),a.value=o(),c.value=!1};return()=>l(Ie,{actionsElement:l(We,null,l($e,{icon:l(Ce,null),variant:"primary",onClick:()=>{a.value=o(),c.value=!0}}))},l(Le,{size:"medium",value:i.value,onUpdateValue:r=>{i.value=r,t.replace({name:Be.Friend,query:{state:r}})}},l(fe,{name:S.Pass,tab:"\u670B\u53CB\u4EEC"},l("div",{class:""})),l(fe,{name:S.Audit,tab:()=>l(Ge,{value:s.value,processing:!0},l(Qe,null,"\u5F85\u5BA1\u6838"))},l("div",{class:""}))),l(Me,{loading:j.value,data:n,nTableProps:{maxHeight:"calc(100vh - 22rem)"},columns:[{title:"\u5934\u50CF",key:"avatar",render(r){const b=ce(()=>{const f=B(!r.avatar);return He(()=>{if(r.avatar){const y=new Image;y.src=r.avatar,y.onload=p=>{f.value=!0}}}),()=>r.avatar?f.value?l(re,{src:r.avatar,round:!0}):l(re,{round:!0},r.name.charAt(0)):l(re,{round:!0},r.name.charAt(0))});return l(b,null)}},{title:"\u540D\u79F0",key:"name"},{title:"\u7C7B\u578B",key:"type",render(r){return["\u670B\u53CB","\u6536\u85CF"][r.type|0]}},{title:"\u7F51\u5740",key:"url",render(r){return l("a",{target:"_blank",href:r.url,rel:"noreferrer"},r.url)}},{title:"\u63CF\u8FF0",key:"description"},{title:"\u64CD\u4F5C",fixed:"right",key:"id",render(r){return l(se,{wrap:!1},r.state==S.Audit&&l(A,{text:!0,size:"tiny",type:"success",onClick:async()=>{await w.api.links.audit(r.id).patch(),d.success("\u901A\u8FC7\u4E86\u6765\u81EA"+r.name+"\u7684\u53CB\u94FE\u9080\u8BF7");const b=n.value.findIndex(f=>f.id==r.id);n.value.splice(b,1),s.value--}},"\u901A\u8FC7"),l(A,{text:!0,size:"tiny",type:"info",onClick:b=>{c.value=!0,a.value={...r}}},"\u7F16\u8F91"),l(Ue,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await w.api.links(r.id).delete(),d.success("\u5220\u9664\u6210\u529F"),await v(m.value.currentPage),r.state==S.Audit&&s.value--}},{trigger:()=>l(A,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>l("span",{style:{maxWidth:"12rem"}},"\u786E\u5B9A\u8981\u5220\u9664\u53CB\u94FE ",r.name," ?")}))}}],onFetchData:v,pager:m}),l(De,{show:c.value,onUpdateShow:r=>void(c.value=r)},l(ze,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:a.value.id?"\u7F16\u8F91: "+a.value.name:"\u65B0\u589E"},l(Re,null,l(I,{label:"\u540D\u5B57",required:!0},l(V,{autofocus:!0,value:a.value.name,onInput:r=>void(a.value.name=r)})),l(I,{label:"\u5934\u50CF"},l(V,{autofocus:!0,value:a.value.avatar,onInput:r=>void(a.value.avatar=r)})),l(I,{label:"\u7F51\u5740",required:!0},l(V,{autofocus:!0,value:a.value.url,onInput:r=>void(a.value.url=r)})),l(I,{label:"\u63CF\u8FF0"},l(V,{autofocus:!0,value:a.value.description,onInput:r=>void(a.value.description=r)})),l(I,{label:"\u7C7B\u578B"},l(qe,{placeholder:"\u9009\u62E9\u7C7B\u578B",options:[{label:"\u670B\u53CB",value:E.Friend},{label:"\u6536\u85CF",value:E.Collection}],value:a.value.type,onUpdateValue:r=>void(a.value.type=r|0)}))),l("div",{class:"text-right"},l(se,{size:12,align:"center",inline:!0},l(A,{type:"success",onClick:_,round:!0},"\u786E\u5B9A"),l(A,{onClick:()=>{c.value=!1,a.value=o()},round:!0},"\u53D6\u6D88"))))))}});export{It as default};
