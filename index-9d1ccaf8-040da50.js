import{L as t,d as e,i as s,N as i,s as n,T as r,a,b as h,l as o,P as l,g as u,c as p,t as f,e as c}from"./codemirror-a3269062-040da50.js";import"./vendor-836ee71d-040da50.js";import"./props-d14b6f97-040da50.js";function d(t,e,s,i=0,n=0){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);let r=n;for(let a=i;a<e;a++)9==t.charCodeAt(a)?r+=s-r%s:r++;return r}class g{constructor(t,e,s){this.string=t,this.tabSize=e,this.indentUnit=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e,s=this.string.charAt(this.pos);if(e="string"==typeof t?s==t:s&&(t instanceof RegExp?t.test(s):t(s)),e)return++this.pos,s}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=d(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){return d(this.string,null,this.tabSize)}match(t,e,s){if("string"==typeof t){let i=t=>s?t.toLowerCase():t;return i(this.string.substr(this.pos,t.length))==i(t)?(!1!==e&&(this.pos+=t.length),!0):null}{let s=this.string.slice(this.pos).match(t);return s&&s.index>0?null:(s&&!1!==e&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}}function m(t){if("object"!=typeof t)return t;let e={};for(let s in t){let i=t[s];e[s]=i instanceof Array?i.slice():i}return e}class k extends t{constructor(t){let n,r=e(t.languageData),h={token:(u=t).token,blankLine:u.blankLine||(()=>{}),startState:u.startState||(()=>!0),copyState:u.copyState||m,indent:u.indent||(()=>null),languageData:u.languageData||{}};var u;super(r,new class extends l{createParse(t,e,s){return new S(n,t,e,s)}},function(t){let e=a.define({id:y.length,name:"Document",props:[o.add((()=>t))]});return y.push(e),e}(r),[s.of(((t,e)=>this.getIndent(t,e)))]),n=this,this.streamParser=h,this.stateAfter=new i({perNode:!0})}static define(t){return new k(t)}getIndent(t,e){let s=n(t.state),i=s.resolve(e);for(;i&&i.type!=this.topNode;)i=i.parent;if(!i)return null;let r,a,h=P(this,s,0,i.from,e);if(h?(a=h.state,r=h.pos+1):(a=this.streamParser.startState(t.unit),r=0),e-r>1e4)return null;for(;r<e;){let s=t.state.doc.lineAt(r),i=Math.min(e,s.to);if(s.length){let e=new g(s.text,t.state.tabSize,t.unit);for(;e.pos<i-s.from;)w(this.streamParser.token,e,a)}else this.streamParser.blankLine(a,t.unit);if(i==e)break;r=s.to+1}let{text:o}=t.state.doc.lineAt(e);return this.streamParser.indent(a,/^\s*(.*)/.exec(o)[1],t)}get allowsNesting(){return!1}}function P(t,e,s,i,n){let a=s>=i&&s+e.length<=n&&e.prop(t.stateAfter);if(a)return{state:t.streamParser.copyState(a),pos:s+e.length};for(let h=e.children.length-1;h>=0;h--){let a=e.children[h],o=s+e.positions[h],l=a instanceof r&&o<n&&P(t,a,o,i,n);if(l)return l}return null}function b(t,e,s,i,n){if(n&&s<=0&&i>=e.length)return e;n||e.type!=t.topNode||(n=!0);for(let a=e.children.length-1;a>=0;a--){let h,o=e.positions[a]+s,l=e.children[a];if(o<i&&l instanceof r){if(!(h=b(t,l,s-o,i-o,n)))break;return n?new r(e.type,e.children.slice(0,a).concat(h),e.positions.slice(0,a+1),o+h.length):h}}return null}class S{constructor(t,e,s,i){this.lang=t,this.input=e,this.fragments=s,this.ranges=i,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=i[i.length-1].to;let n=c.get(),a=i[0].from,{state:h,tree:o}=function(t,e,s,i){for(let n of e){let e,i=n.from+(n.openStart?25:0),r=n.to-(n.openEnd?25:0),a=i<=s&&r>s&&P(t,n.tree,0-n.offset,s,r);if(a&&(e=b(t,n.tree,s+n.offset,a.pos+n.offset,!1)))return{state:a.state,tree:e}}return{state:t.streamParser.startState(i?u(i):4),tree:r.empty}}(t,s,a,null==n?void 0:n.state);this.state=h,this.parsedPos=this.chunkStart=a+o.length,o.length&&(this.chunks.push(o),this.chunkPos.push(0)),n&&this.parsedPos<n.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(u(n.state)),n.skipUntilInView(this.parsedPos,n.viewport.from),this.parsedPos=n.viewport.from)}advance(){let t=c.get(),e=null==this.stoppedAt?this.to:this.stoppedAt,s=Math.min(e,this.chunkStart+2048);for(t&&(s=Math.min(s,t.viewport.to));this.parsedPos<s;)this.parseLine(t);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=e?this.finish():t&&this.parsedPos>t.viewport.to?(t.skipUntilInView(this.parsedPos,e),this.finish()):null}stopAt(t){this.stoppedAt=t}lineAfter(t){let e=this.input.chunk(t);if(this.input.lineChunks)"\n"==e&&(e="");else{let t=e.indexOf("\n");t>-1&&(e=e.slice(0,t))}return t+e.length<=this.to?e:e.slice(0,this.to-t)}nextLine(){let t=this.parsedPos,e=this.lineAfter(t),s=t+e.length;for(let i=this.rangeIndex;;){let t=this.ranges[i].to;if(t>=s)break;if(e=e.slice(0,t-(s-e.length)),i++,i==this.ranges.length)break;let n=this.ranges[i].from,r=this.lineAfter(n);e+=r,s=n+r.length}return{line:e,end:s}}skipGapsTo(t,e,s){for(;;){let i=this.ranges[this.rangeIndex].to,n=t+e;if(s>0?i>n:i>=n)break;e+=this.ranges[++this.rangeIndex].from-i}return e}emitToken(t,e,s,i,n){if(this.ranges.length>1){e+=n=this.skipGapsTo(e,n,1);let t=this.chunk.length;s+=n=this.skipGapsTo(s,n,-1),i+=this.chunk.length-t}return this.chunk.push(t,e,s,i),n}parseLine(t){let{line:e,end:s}=this.nextLine(),i=0,{streamParser:n}=this.lang,r=new g(e,t?t.state.tabSize:4,t?u(t.state):2);if(r.eol())n.blankLine(this.state,r.indentUnit);else for(;!r.eol();){let t=w(n.token,r,this.state);t&&(i=this.emitToken(N(t),this.parsedPos+r.start,this.parsedPos+r.pos,4,i))}this.parsedPos=s,this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let t=r.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:x,topID:0,maxBufferLength:2048,reused:this.chunkReused});t=new r(t.type,t.children,t.positions,t.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(t),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new r(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function w(t,e,s){e.start=e.pos;for(let i=0;i<10;i++){let i=t(e,s);if(e.pos>e.start)return i}throw new Error("Stream parser failed to advance stream.")}const v=Object.create(null),y=[a.none],x=new p(y),A=[];function N(t){return t?v[t]||(v[t]=function(t){let e=null;for(let n of t.split(".")){let t=f[n];t?"function"==typeof t?e?e=t(e):C(n,`Modifier ${n} used at start of tag`):e?C(n,`Tag ${n} used as modifier`):e=t:C(n,`Unknown highlighting tag ${n}`)}if(!e)return 0;let s=t.replace(/ /g,"_"),i=a.define({id:y.length,name:s,props:[h({[s]:e})]});return y.push(i),i.id}(t)):0}for(let[L,I]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])v[L]=N(I);function C(t,e){A.indexOf(t)>-1||(A.push(t),console.warn(e))}export{k as StreamLanguage,g as StringStream};
