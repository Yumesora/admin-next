import{d as a,b as e,aS as t,af as l,ab as n,u as s,r,B as i,w as o,aT as u,aH as c,h as d,bc as v,Q as p,b1 as m,bh as w,a_ as g,x as h,J as x,I as y,G as f,bn as b,bo as k,bp as z,bq as C,F as L,br as R,O as T,aW as j}from"./vendor-48a40c3c-50ab21a.js";import{T as q}from"./Trash-5b9edaa8-50ab21a.js";import{H as S}from"./rounded-button-a3a7c1bf-50ab21a.js";import{R as A,u as M,d as E,a as U,I as _,B,b as H,U as P}from"./index-50ab21a.js";import{T as J}from"./index-4a6aebcc-50ab21a.js";import{u as F}from"./use-table-11d1f158-50ab21a.js";const I={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},N=l("g",{fill:"none"},[l("path",{d:"M17.5 12a5.5 5.5 0 1 1 0 11a5.5 5.5 0 0 1 0-11zM12 2c5.524 0 10.002 4.478 10.002 10.002c0 .263-.01.524-.03.782a6.507 6.507 0 0 0-1.475-1.052a8.501 8.501 0 1 0-8.765 8.767a6.5 6.5 0 0 0 1.05 1.474c-.257.02-.518.03-.782.03c-5.524 0-10.002-4.478-10.002-10.001C1.998 6.477 6.476 1.999 12 1.999zm5.5 12l-.09.008a.5.5 0 0 0-.402.402L17 14.5V17L14.498 17l-.09.008a.5.5 0 0 0-.402.402l-.008.09l.008.09a.5.5 0 0 0 .402.402l.09.008H17v2.503l.008.09a.5.5 0 0 0 .402.402l.09.008l.09-.008a.5.5 0 0 0 .402-.402l.008-.09V18l2.504.001l.09-.008a.5.5 0 0 0 .402-.402l.008-.09l-.008-.09a.5.5 0 0 0-.402-.402l-.09-.008H18v-2.5l-.008-.09a.5.5 0 0 0-.402-.403L17.5 14zm-9.038.785a4.494 4.494 0 0 0 2.63 1.626a6.449 6.449 0 0 0-.079 1.51a5.983 5.983 0 0 1-3.73-2.208a.75.75 0 0 1 1.179-.928zM9 8.75a1.25 1.25 0 1 1 0 2.499A1.25 1.25 0 0 1 9 8.75zm6 0a1.25 1.25 0 1 1 0 2.499a1.25 1.25 0 0 1 0-2.499z",fill:"currentColor"})],-1);var V=a({name:"EmojiAdd24Regular",render:function(a,l){return e(),t("svg",I,[N])}});const W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},D=l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-miterlimit":"10","stroke-width":"44",d:"M416 128L192 384l-96-96"},null,-1);var K=a({name:"CheckmarkSharp",render:function(a,l){return e(),t("svg",W,[D])}});const G={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},O=l("path",{d:"M400 145.49L366.51 112L256 222.51L145.49 112L112 145.49L222.51 256L112 366.51L145.49 400L256 289.49L366.51 400L400 366.51L289.49 256L400 145.49z",fill:"currentColor"},null,-1);var Q=a({name:"CloseSharp",render:function(a,l){return e(),t("svg",G,[O])}});const $=["(๑•̀ㅂ•́)و✧","(°ー°〃)","o(￣ヘ￣o＃)","(๑¯◡¯๑)","( •̀ .̫ •́ )✧","(つд⊂)","(o´ω`o)","(•౪• )","(>▽<)","(๑•̀ㅂ•́) ✧","ლ(╹◡╹ლ)","_(:з」∠)_","Ծ‸Ծ"," ʕ •̀ o •́ ʔ"," (⑉･̆⌓･̆⑉)"," ♫.(◕∠◕).♫"," | •́ ▾ •̀ |"," 〳 ° ▾ ° 〵"," | •́ ▾ •̀ |"," ⋋╏ ❛ ◡ ❛ ╏⋌"," (・∀・)"," (^・ω・^ )","(´･ω･`)  ","(๑´ㅂ`๑) ","(๑˘ ₃˘๑) ","(●’ω`●）","(´･ω･`)  "];var X,Y,Z,aa;(Y=X||(X={}))[Y.Unread=0]="Unread",Y[Y.Read=1]="Read",Y[Y.Junk=2]="Junk",(aa=Z||(Z={}))[aa.Pending=0]="Pending",aa[aa.Marked=1]="Marked",aa[aa.Trash=2]="Trash";const ea=a((()=>{const a=n(),e=s(),t=r(+a.query.state),{data:l,checkedRowKeys:I,fetchDataFn:N,pager:W,loading:D}=F(((e,t)=>async(l=a.query.page||1,n=10,s=a.query.state)=>{const r=await A.api.comments.get({params:{page:l,size:n,state:0|s}});e.value=r.data,t.value=r.pagination})),G=i(),O=r(!1),Y=r(null),Z=r(""),aa=r(),ea=async()=>{Y.value&&(await A.api.comments.master.reply(Y.value.id).post({data:{text:Z.value}}),O.value=!1,Y.value=null,G.success("回复成功啦~"),Z.value="",await ta())},ta=N;async function la(a,e){Array.isArray(a)?a.map((async a=>{await A.api.comments(a).patch({data:{state:e}})})):await A.api.comments(a).patch({data:{state:e}}),G.success("操作完成"),await ta()}async function na(a){if(Array.isArray(a))try{await Promise.all(a.map((a=>A.api.comments(a).delete({errorHandler:a=>{}}))))}catch{}else await A.api.comments(a).delete();await ta(),G.success("删除成功")}o((()=>a.query.page),(async a=>{await ta(a)}),{immediate:!0}),o((()=>a.query.state),(async a=>{await ta()}));const sa=u([{title:"",key:"avatar",width:60,render:a=>d(R,{circle:!0,src:a.avatar})},{title:"作者",key:"author",width:200,render:(a,e)=>d(f,{vertical:!0,size:2},d("a",{href:a.url||"#",target:"_blank",rel:"noreferrer"},a.author),d("a",{href:"mailto:"+a.mail||"",target:"_blank"},a.mail),d("div",null,d(_,{ip:a.ip,trigger:"hover",triggerEl:d(T,{depth:"3",class:"select-all"},a.ip)})))},{title:"内容",key:"text",render(a){const e=(()=>{switch(a.refType){case"Post":return B+"/posts/"+a.ref.slug;case"Note":return B+"/notes/"+a.ref.nid;case"Page":return B+"/"+a.ref.slug}})();return d(f,{vertical:!0,size:2},d(f,{size:5},d("span",null,H(a.created)),d("span",null,"于"),d("a",{href:e,target:"_blank"},a.ref.title)),d("p",null,a.text),a.parent&&d("blockquote",{class:"border-l-[3px] border-solid border-primary-default pl-[12px] my-2 ml-4"},d(f,{size:2,align:"center"},d(T,{depth:"2"},a.parent.author," 在 ",H(a.parent.created)," 说: ",a.parent.text))),!D.value&&d("div",{class:"space-x-3"},1!==t.value&&d(x,{text:!0,size:"tiny",type:"success",onClick:()=>la(a.id,1)},"已读"),2!==t.value&&d(x,{text:!0,size:"tiny",type:"warning",onClick:()=>la(a.id,2)},"垃圾"),2!==t.value&&d(x,{text:!0,size:"tiny",type:"info",onClick:e=>{Y.value=a,O.value=!0}},"回复"),d(j,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{na(a.id)}},{trigger:()=>d(x,{text:!0,size:"tiny",type:"error"},"删除"),default:()=>d("span",{style:{maxWidth:"12rem"}},"确定要删除 ",a.title," ?")}))," ")}}]),ra=c(),{viewport:ia}=M(P);return()=>d(U,{actionsElement:d(L,null,1!==t.value&&d(S,{name:"已读",icon:d(K,null),variant:"success",onClick:()=>{la(I.value,X.Read),I.value.length=0}}),2!==t.value&&d(S,{name:"标记为垃圾",icon:d(q,null),variant:"warning",onClick:()=>{la(I.value,X.Junk),I.value.length=0}}),d(S,{name:"删除",icon:d(Q,null),variant:"error",onClick:()=>{ra.warning({title:"警告",content:"你确定要删除多条评论？",negativeText:"确定",positiveText:"不确定",onNegativeClick:async()=>{await na(I.value),I.value.length=0}})}}))},d(z,{size:"medium",value:t.value,onUpdateValue:a=>{e.replace({name:E.Comment,query:{state:a}}).then((()=>{t.value=a}))}},d(C,{name:0,tab:"未读"},d("div",{class:""})),d(C,{name:1,tab:"已读"},d("div",{class:""})),d(C,{name:2,tab:"垃圾"},d("div",{class:""}))),d(J,{maxWidth:600,data:l,loading:D.value,onFetchData:ta,pager:W,onUpdateCheckedRowKeys:a=>{I.value=a},columns:[{type:"selection",options:["none","all"],width:30},...sa]}),d(v,{show:!!O.value,onUpdateShow:a=>{a||(O.value=a)}},Y.value&&d(p,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:"回复: "+Y.value.author},d(m,{onSubmit:ea},d(w,{label:Y.value.author+" 说:"},d(g,{disabled:!0,value:Y.value.text,type:"textarea",autosize:{minRows:4,maxRows:10}})),d(w,{label:"回复内容"},d(g,{ref:aa,value:Z.value,type:"textarea",onInput:a=>Z.value=a,autosize:{minRows:4,maxRows:10}})),d("div",{class:"flex justify-between"},d(h,{trigger:"click",placement:ia.value.mobile?"top-end":"left"},{trigger:()=>d(x,{text:!0,class:"text-[20px]"},d(y,null,d(V,null))),default:()=>d(p,{style:"max-width: 300px",bordered:!1},d(f,{align:"center",class:"!justify-between"},$.map((a=>d(x,{text:!0,key:a,type:"primary",onClick:()=>{if(!aa.value)return;const e=b(aa.value).textareaElRef;e.focus(),k((()=>{const t=e.selectionStart,l=e.selectionEnd;e.value=e.value.substring(0,t)+` ${a} `+e.value.substring(l,e.value.length),Z.value=e.value,k((()=>{const l=t+a.length+2;e.selectionStart=l,e.selectionEnd=l,e.focus()}))}))}},a)))))}),d(f,{size:12,align:"center",inline:!0},d(x,{type:"success",onClick:ea,round:!0},"确定"),d(x,{onClick:()=>{Z.value="",O.value=!1},round:!0},"取消")))))))}));export{ea as default};
//# sourceMappingURL=index-9b8e4293-50ab21a.js.map
