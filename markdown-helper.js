import{a as e,R as a}from"./index.js";import{r as t}from"./index10.js";import{d as l,r as s,G as n,w as r,h as o,b0 as i,b1 as u,b3 as c,A as m,J as p,aZ as d,B as v,bZ as g,k as f,bE as h,Q as w,b4 as b}from"./vendor.js";class x{constructor(e){this.strList=e}parse(e){const a=e,t=/-{3,}\n(.*?)-{3,}\n*(.*)$/gms.exec(a);if(!t)return{text:a};const l=t[1],s=t.pop(),n=l.split("\n"),r=[],o=[];let i=null;const u=n.reduce(((e,a)=>{const t=a.trim().split(":").filter((e=>e.length)),l=t.length>=2?[t[0],t.slice(1).filter((e=>e.length)).join(":").trim()]:[t[0]];if(2===l.length){const[a,t]=l;["date","updated"].includes(a)?e[a]=new Date(t.trim()).toISOString():["categories:","tags:"].includes(a)?i="categories:"===a?"cate":"tag":e[a]=t.trim()}else{const t=a.trim().replace(/^\s*-\s*/,"");if(["","tags:","categories:"].includes(t))return i="categories:"===t?"cate":"tag",e;"tag"===i?r.push(t):o.push(t)}return e}),{});return u.categories=o,u.tags=r,{meta:u,text:s}}start(){const e=this.strList,a=[];for(const t of e)a.push(this.parse(t));return a}}var k,y;(y=k||(k={})).Post="post",y.Note="note";const P=[{value:k.Post,label:"博文"},{label:"日记",value:k.Note}];var A=l((()=>{const l=s(k.Post),y=s([]),A=s([]);const D=n();async function L(e){if(null==e||e.preventDefault(),null==e||e.stopPropagation(),!y.value.length)throw new ReferenceError("fileList is empty");const a=[];for await(const l of y.value){const e=await Promise.resolve(new Promise(((e,a)=>{const t=l.file;if(!t)return a("File is empty");if("text/markdown"!==t.type)return D.error("只能转换 markdown 文件"),a("File must be markdown.");const s=new FileReader;s.onload=a=>{var t;e((null==(t=a.target)?void 0:t.result)||"")},s.readAsText(t)})));a.push(e)}const t=function(e){return new x(e).start().map(((e,a)=>{var t,l;const s=y.value[a].file.name.replace(/\.md$/,"");return e.meta?e.meta.slug=null!=(t=e.meta.slug)?t:s:e.meta={title:s,slug:s},(null==(l=e.meta)?void 0:l.date)||(e.meta.date=(new Date).toISOString()),e}))}(a);D.success("解析完成, 结果查看 console 哦"),A.value=t.map(((e,a)=>{var t,l;return{...e,filename:null!=(l=null==(t=y.value[a].file)?void 0:t.name)?l:""}})),console.log(b(A))}async function j(e){if(e.stopPropagation(),e.preventDefault(),!A.value.length)return D.error("请先解析!!");await a.api.markdown.import.post({data:{type:l.value,data:A.value}}),D.success("上传成功!"),y.value=[]}const C=s(!0),F=s(!1),R=s(!1);async function S(){const e=await a.api.markdown.export.get({params:{slug:R.value,yaml:C.value,show_title:F.value},responseType:"blob"});t(e,"markdown.zip")}return r((()=>y.value),(e=>{0==e.length?A.value=[]:L()})),()=>o(e,null,o(p,null,"从 MarkDown 导入数据"),o(i,{labelAlign:"right",labelPlacement:"left",labelWidth:150,class:"max-w-[300px]"},o(u,{label:"导入到:"},o(d,{options:P,value:l.value,onUpdateValue:e=>{l.value=e}})),o(u,{label:"准备好了吗."},o(v,{vertical:!0},o(g,{multiple:!0,accept:".md,.markdown",onChange:f((e=>{y.value=e.fileList}),250),onRemove:e=>{const a=e.file.name,t=A.value.findIndex((e=>e.filename===a));-1!=t&&A.value.splice(t,1)}},o(h,null,o(m,{round:!0},"先上传"),o(m,{onClick:L,disabled:!y.value.length},"再解析"),o(m,{onClick:j,round:!0,disabled:!A.value.length},"最后导入"))),o(w,{depth:2,class:"!text-sm"},"只能上传markdown文件")))),o(p,null,"导出数据到 Markdown (Hexo YAML Format)"),o(i,{labelAlign:"right",labelPlacement:"left",labelWidth:180,class:"max-w-[400px]"},o(u,{label:"是否包括 yaml header"},o(c,{value:C.value,onUpdateValue:e=>{C.value=e}})),o(u,{label:"是否在第一行显示文章标题"},o(c,{value:F.value,onUpdateValue:e=>{F.value=e}})),o(u,{label:"根据 slug 生成文件名"},o(c,{value:R.value,onUpdateValue:e=>{R.value=e}})),o("div",{class:"text-right w-full"},o(m,{type:"primary",onClick:S},"导出"))))}));export{A as default};
