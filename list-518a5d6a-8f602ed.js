import{d as e,b as t,aQ as a,af as r,B as i,aF as s,ab as o,w as l,o as n,k as d,aR as c,h as u,aS as p,aT as g,ao as f,I as m,aU as y,J as v,G as w,F as h}from"./vendor-42f259f3-8f602ed.js";import{A as k}from"./Add12Filled-b370f332-8f602ed.js";import{D as x}from"./Delete16Regular-fc4e368d-8f602ed.js";import{T as b}from"./index-56894b8d-8f602ed.js";import{E as j}from"./edit-column-b0e438aa-8f602ed.js";import{R as T}from"./relative-time-f939995b-8f602ed.js";import{R as P,u as C,C as O,a as B}from"./index-8f602ed.js";import{u as z}from"./use-table-eedfc842-8f602ed.js";import{H as D}from"./rounded-button-79e5eb1e-8f602ed.js";const F={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},I=r("path",{d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24s24 10.745 24 24s-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098c.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469c8.681 25.895-.069 57.704-16.382 74.757c4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725c-15.957-7.099-36.821-15.887-52.651-16.178c-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521c39.614-39.144 56.648-80.587 89.117-113.111c14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z",fill:"currentColor"},null,-1);var R=e({name:"ThumbsUp",render:function(e,r){return t(),a("svg",F,[I])}});const U=e({name:"PostList",setup(){const{loading:t,checkedRowKeys:a,data:r,pager:F,sortProps:I,fetchDataFn:U}=z(((e,t)=>async(a=S.query.page||1,r=20)=>{const i=await P.api.posts.get({params:{page:a,size:r,select:"title _id id created modified categoryId copyright tags count",...I.sortBy?{sortBy:I.sortBy,sortOrder:I.sortOrder}:{}}});e.value=i.data,t.value=i.pagination})),A=i(),M=s(),S=o(),q=U;l((()=>S.query.page),(async e=>{await q(e)}));const H=C(O);n((async()=>{await q(),await H.fetch()}));const K=e({setup(){const e=d((()=>{var e;return(null==(e=H.data.value)?void 0:e.map((e=>({label:e.name,value:e.id}))))||[]})),i=c([{type:"selection",options:["none","all"]},{title:"标题",sortOrder:!1,sorter:"default",key:"title",width:200,ellipsis:!0,render:e=>u(g,{to:"/posts/edit?id="+e.id},e.title)},{title:"分类",sortOrder:!1,sorter:"default",key:"category",width:80,ellipsis:!0,filterOptions:e,filter:!0,render(e){var t,a,i;return H.map.value?u(j,{returnToConfrim:!1,initialValue:null!=(a=null==(t=H.map.value.get(e.categoryId))?void 0:t.name)?a:"",onSubmit:async t=>{await P.api.posts(e.id).patch({data:{categoryId:t}}),A.success("修改成功~!"),r.value.find((t=>t.id===e.id)).categoryId=t},type:"select",options:(null==(i=H.data.value)?void 0:i.map((e=>({label:e.name,value:e.id,key:e.id}))))||[]}):""}},{title:"标签",key:"tags",width:100,ellipsis:!0,render(e){var t;return null==(t=e.tags)?void 0:t.join("，")}},{title:()=>u(m,null,u(f,null)),key:"count.read",width:50,render(e){var t;return(null==(t=e.count)?void 0:t.read)||0}},{title:()=>u(m,null,u(R,null)),width:50,key:"count.like",render(e){var t;return(null==(t=e.count)?void 0:t.like)||0}},{title:"创建于",width:100,key:"created",sortOrder:"descend",sorter:"default",render:e=>u(T,{time:e.created})},{title:"修改于",key:"modified",sorter:"default",sortOrder:!1,width:100,render:e=>u(T,{time:e.modified})},{title:"操作",fixed:"right",width:60,key:"id",render:e=>u(w,null,u(y,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await P.api.posts(e.id).delete(),A.success("删除成功"),await q(F.value.currentPage)}},{trigger:()=>u(v,{text:!0,type:"error",size:"tiny"},"移除"),default:()=>u("span",{style:{maxWidth:"12rem"}},"确定要删除 ",e.title," ?")}))}]);return()=>u(b,{loading:t.value,columns:i,data:r,nTableProps:{onUpdateFilters:async(e,t)=>{if(e&&e.category&&Array.isArray(e.category)){if(!e.category.length)return void(await q());const t=e.category.join(",");let{data:a}=await P.api.categories.get({params:{ids:t}});a=a.map((e=>e.category.children.map((t=>({...p(e.category,["children","id","id"]),...t,categoryId:e.category.id}))))).sort(((e,t)=>new Date(e).getTime()-new Date(t).getTime())).flat(),r.value=a,F.value={currentPage:1,total:1,size:0,hasNextPage:!1,hasPrevPage:!1,totalPage:1}}}},onFetchData:q,pager:F,onUpdateCheckedRowKeys:e=>{a.value=e},onUpdateSorter:async e=>{I.sortBy=e.sortBy,I.sortOrder=e.sortOrder}})}});return()=>u(B,null,{actions:()=>u(h,null,u(D,{variant:"error",disabled:0==a.value.length,onClick:()=>{M.warning({title:"警告",content:"你确定要删除？",positiveText:"确定",negativeText:"不确定",onPositiveClick:async()=>{for(const e of a.value)await P.api.posts(e).delete();a.value.length=0,A.success("删除成功"),await q()}})},icon:u(x,null)}),u(D,{to:"/posts/edit",icon:u(k,null)})),default:()=>u(K,null)})}});export{U as ManagePostListView};
//# sourceMappingURL=list-518a5d6a-8f602ed.js.map
