import{e,u as a,R as l,U as t,p as s,j as n,d as o,A as i,I as u,a as r}from"./index-2832c04.js";import{d as p,o as d,h as c,C as v,r as m,bS as b,w,l as y,aT as g,bT as h,bU as x,b0 as f,K as O,bV as k,y as I,b1 as S,b2 as U,b3 as P,b8 as C,B as T,Q as V,F as A,bR as E,aU as K,bW as N,b4 as j,E as _,aY as z,aW as L,A as q,I as G,ba as W,U as B,bF as H,q as M,u as D,G as R,L as F,af as J,bJ as Q,bK as X}from"./vendor-1c1ffc5b-2832c04.js";import{P as Y}from"./Plus-6682fa3e-2832c04.js";import{R as Z}from"./relative-time-d32fba83-2832c04.js";import{v as $}from"./index-5b48b49e-2832c04.js";import{H as ee}from"./rounded-button-80ae2c98-2832c04.js";import{d as ae,s as le}from"./index-1d314389-2832c04.js";var te={};Object.defineProperty(te,"__esModule",{value:!0});const se=$.exports,ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},oe=se.createVNode("path",{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0 0 51.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z",fill:"currentColor"},null,-1),ie=se.createVNode("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1);var ue=te.default=se.defineComponent({name:"CheckCircleOutlined",render:function(e,a){return se.openBlock(),se.createBlock("svg",ne,[oe,ie])}});const re={class:"mt-6",labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},pe={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},de=p((()=>{const{setHeaderButton:s}=e();d((()=>{s(c(ee,{disabled:!0,onClick:u,icon:c(ue,null)}))})),v((()=>{s(null)}));let n={};const o=m(ce({})),i=m({});async function u(){if(E(i.value))return;const e=Object.entries(i.value);for await(const[a,t]of e){const e=Object.fromEntries(Object.entries(t).map((([e,l])=>Array.isArray(l)?[e,o.value[a][e]]:[e,l])));await l.api.options(a).patch({data:e})}await r(),message.success("修改成功")}w((()=>o.value),(e=>{i.value=ae(n,j(e))}),{deep:!0}),w((()=>i.value),(e=>{let a=!1;a=!E(e),s(c(ee,{disabled:!a,icon:c(ue,null),onClick:u}))}));const r=async()=>{let e=await l.api.options.get();e=ce(K(e,["ok"])),n=N(e),o.value=e};d((()=>{r()}));const p=m(["website"]),b=a(t),_=y((()=>b.viewport.value.mobile?1:2)),z=g(re);return w((()=>b.viewport.value.mobile),(e=>{e?(z.labelPlacement="top",z.labelAlign="left"):(z.labelPlacement="left",z.labelAlign="right")}),{immediate:!0}),()=>{var e,a;return c(A,null,c("div",{class:"pt-4"}),c(h,{accordion:!0,displayDirective:"if",expandedNames:p.value,onUpdateExpandedNames:e=>{p.value=e}},c(x,{title:"网站设置",name:"website"},c(f,{...z},c(O,{cols:_.value,xGap:12},c(k,{span:1,label:"前端地址"},c(I,{value:o.value.url.webUrl,onInput:e=>{o.value.url.webUrl=e}})),c(k,{span:1,label:"API 地址"},c(I,{value:o.value.url.serverUrl,onInput:e=>{o.value.url.serverUrl=e}})),c(k,{span:1,label:"后台地址"},c(I,{value:o.value.url.adminUrl,onInput:e=>{o.value.url.adminUrl=e}})),c(k,{span:1,label:"Gateway 地址"},c(I,{value:o.value.url.wsUrl,onInput:e=>{o.value.url.wsUrl=e}}))))),c(x,{title:"SEO 优化",name:"seo"},c(f,{...z},c(S,{label:"网站标题"},c(I,{...pe,value:o.value.seo.title,onInput:e=>{o.value.seo.title=e}})),c(S,{label:"网站描述"},c(I,{...pe,value:o.value.seo.description,onInput:e=>{o.value.seo.description=e}})),c(S,{label:"关键字"},c(U,{round:!0,type:"primary",value:o.value.seo.keywords,onChange:e=>{o.value.seo.keywords=e}})))),c(x,{title:"后台附加设置",name:"adminExtra"},c(f,{...z},c(S,{label:"开启后台管理反代"},c(P,{value:o.value.adminExtra.enableAdminProxy,onUpdateValue:e=>{o.value.adminExtra.enableAdminProxy=e}})),c(S,{label:"中后台标题"},c(I,{...pe,value:o.value.adminExtra.title,onUpdateValue:e=>{o.value.adminExtra.title=e}})),c(S,{label:"登录页面背景"},c(I,{...pe,value:o.value.adminExtra.background,inputProps:{autocomplete:"off"},onUpdateValue:e=>{o.value.adminExtra.background=e}})),c(S,{label:"高德查询 API Key"},c(I,{...pe,value:o.value.adminExtra.gaodemapKey,type:"password",showPasswordToggle:!0,clearable:!0,inputProps:{autocomplete:"off"},onUpdateValue:e=>{o.value.adminExtra.gaodemapKey=e}})))),c(x,{title:"评论设置",name:"comment"},c(f,{...z},c(S,{label:"反垃圾评论"},c(P,{value:o.value.commentOptions.antiSpam,onUpdateValue:e=>{o.value.commentOptions.antiSpam=e}})),c(S,{label:"自定义屏蔽关键词"},c(U,{disabled:!o.value.commentOptions.antiSpam,value:o.value.commentOptions.spamKeywords,onUpdateValue:e=>{o.value.commentOptions.spamKeywords=e},type:"primary"})),c(S,{label:"自定义屏蔽 IP"},c(U,{disabled:!o.value.commentOptions.antiSpam,value:o.value.commentOptions.blockIps,onUpdateValue:e=>{o.value.commentOptions.blockIps=e},type:"primary"})),c(S,{label:"禁止非中文评论"},c(P,{value:o.value.commentOptions.disableNoChinese,onUpdateValue:e=>{o.value.commentOptions.disableNoChinese=e}})))),c(x,{title:"邮件通知设置",name:"mail"},c(f,{...z},c(S,{label:"开启评论邮箱提醒"},c(P,{value:o.value.mailOptions.enable,onUpdateValue:e=>{o.value.mailOptions.enable=e}})),c(O,{cols:_.value,xGap:12},c(k,{span:1,label:"发件邮箱 host"},c(I,{value:(null==(e=o.value.mailOptions.options)?void 0:e.host)||"",onInput:e=>{o.value.mailOptions.options||(o.value.mailOptions.options={}),o.value.mailOptions.options.host=e}})),c(k,{span:1,label:"发件邮箱端口"},c(C,{value:(null==(a=o.value.mailOptions.options)?void 0:a.port)||465,onChange:e=>{o.value.mailOptions.options||(o.value.mailOptions.options={}),o.value.mailOptions.options.port=null!=e?e:465}})),c(k,{span:1,label:"发件邮箱地址"},c(I,{value:o.value.mailOptions.user,onInput:e=>{o.value.mailOptions.user=e}})),c(k,{span:1,label:"发件邮箱密码"},c(I,{type:"password",showPasswordToggle:!0,inputProps:{name:"email-password",autocomplete:"new-password",autocapitalize:"off",autocorrect:"off"},value:o.value.mailOptions.pass,onInput:e=>{o.value.mailOptions.pass=e}}))))),c(x,{name:"backup",title:"备份"},c(f,{...z},c(S,{label:"开启备份"},c(T,{vertical:!0},c(P,{value:o.value.backupOptions.enable,onUpdateValue:e=>{o.value.backupOptions.enable=e}}),c(V,{class:"text-xs",depth:3},"仅支持备份到 COS"))),c(S,{label:"地域 Region"},c(I,{...pe,value:o.value.backupOptions.region,onInput:e=>{o.value.backupOptions.region=e}})),c(S,{label:"SecretId"},c(I,{...pe,value:o.value.backupOptions.secretId,onInput:e=>{o.value.backupOptions.secretId=e}})),c(S,{label:"SecretKey"},c(I,{...pe,type:"password",inputProps:{name:"secret-key-password",autocomplete:"new-password",autocapitalize:"off",autocorrect:"off"},showPasswordToggle:!0,value:o.value.backupOptions.secretKey,onInput:e=>{o.value.backupOptions.secretKey=e}})))),c(x,{name:"baidu_push",title:"百度推送"},c(f,{...z},c(S,{label:"开启推送"},c(P,{value:o.value.baiduSearchOptions.enable,onUpdateValue:e=>{o.value.baiduSearchOptions.enable=e}})),c(S,{label:"Token",path:"baidu_push"},c(I,{...pe,showPasswordToggle:!0,type:"password",inputProps:{name:"baidu-push-password",autocomplete:"new-password",autocapitalize:"off",autocorrect:"off"},disabled:!o.value.baiduSearchOptions.enable,value:o.value.baiduSearchOptions.token,onUpdateValue:e=>{o.value.baiduSearchOptions.token=e}})))),c(x,{name:"algolia",title:"Algolia Search"},c(f,{...z},c(S,{label:"开启 Algolia Search"},c(P,{value:o.value.algoliaSearchOptions.enable,onUpdateValue:e=>{o.value.algoliaSearchOptions.enable=e}})),c(S,{label:"AppId"},c(I,{...pe,disabled:!o.value.algoliaSearchOptions.enable,value:o.value.algoliaSearchOptions.appId,onInput:e=>{o.value.algoliaSearchOptions.appId=e}})),c(S,{label:"apiKey"},c(I,{...pe,type:"password",disabled:!o.value.algoliaSearchOptions.enable,value:o.value.algoliaSearchOptions.apiKey,onInput:e=>{o.value.algoliaSearchOptions.apiKey=e}})),c(S,{label:"indexName"},c(I,{...pe,disabled:!o.value.algoliaSearchOptions.enable,value:o.value.algoliaSearchOptions.indexName,onInput:e=>{o.value.algoliaSearchOptions.indexName=e}}))))))}}));function ce(e){return b({seo:{title:"",description:"",keywords:[]},url:{wsUrl:"",adminUrl:"",serverUrl:"",webUrl:""},mailOptions:{user:"",pass:"",options:{host:"",port:465},enable:!1},commentOptions:{antiSpam:!1,spamKeywords:[],blockIps:[],disableNoChinese:!1},backupOptions:{enable:!1,secretId:"",secretKey:"",bucket:"",region:""},baiduSearchOptions:{enable:!1,token:""},algoliaSearchOptions:{enable:!1},adminExtra:{enableAdminProxy:!1,background:"",gaodemapKey:"",title:"静かな森"}},e)}const ve=p((()=>()=>c(A,null,c("div",{class:"pt-4"}),c(h,{defaultExpandedNames:["reset"],displayDirective:"if"},c(x,{name:"reset",title:"修改密码"},c(be,null)),c(x,{name:"token",title:"API Token"},c(me,null)))))),me=p((()=>{const e=m([]),n=()=>({name:"",expired:!1,expiredTime:new Date}),o=g(n()),i=async()=>{const{data:a}=await l.api.auth.token.get();e.value=a};_((()=>{i()}));const u=m(!1),r=async()=>{const a={name:o.name,expired:o.expired?o.expiredTime.toISOString():void 0},t=await l.api.auth.token.post({data:a});await navigator.clipboard.writeText(t.token),u.value=!1;const s=n();for(const e in s)o[e]=s[e];message.success("生成成功, Token 已复制, "+t.token),await i();const r=e.value.findIndex((e=>e.name===a.name));-1!==r&&(e.value[r].token=t.token)},p=a(t);return()=>c(M,{class:"!overflow-visible"},c(W,{show:u.value,onUpdateShow:e=>{u.value=e}},c(B,{bordered:!1,title:"创建 Token",class:"max-w-full w-[500px]"},c(f,null,c(S,{label:"名称",required:!0},c(I,{value:o.name,onInput:e=>{o.name=e}})),c(S,{label:"是否过期"},c(P,{value:o.expired,onUpdateValue:e=>{o.expired=e}})),c(S,{label:"过期时间"},c(H,{disabled:!o.expired,value:o.expiredTime,type:"datetime",onUpdateValue:e=>{o.expiredTime=new Date(e)}}))),c(T,null,c(q,{round:!0,onClick:()=>{u.value=!1}},"取消"),c(q,{round:!0,type:"primary",onClick:r},"确定")))),c(q,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{u.value=!0}},c(G,null,c(Y,null)),c("span",{class:"ml-2"},"新增")),c(z,{scrollX:Math.max(800,p.contentWidth.value-p.contentInsetWidth.value),remote:!0,bordered:!1,data:e.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render:({token:e})=>null!=e?e:"*".repeat(40)},{title:"创建时间",key:"created",render:({created:e})=>c(Z,{time:e})},{title:"过期时间",key:"expired",render:({expired:e})=>s(e,"yyyy年M月d日 HH:mm:ss")},{title:"操作",key:"id",render:({id:a,name:t})=>c(T,null,c(L,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{(async a=>{await l.api.auth.token.delete({params:{id:a}}),message.success("删除成功");const t=e.value.findIndex((e=>e.id===a));-1!=t&&e.value.splice(t,1)})(a)}},{trigger:()=>c(q,{text:!0,type:"error"},"删除"),default:()=>c("span",{style:{maxWidth:"12rem"}},'确定要删除 Token "',t,'"?')}))}]}))})),be=p((()=>{const e=g({password:"",reenteredPassword:""}),a=m(),t=D(),s=async()=>{a.value&&a.value.validate((async a=>{a?console.log(a):(await l.api.master.patch({data:{password:e.password}}),message.success("更改成功"),n(),t.push({name:o.Login}))}))};function i(a,l){return console.log(a),l===e.password}return()=>c(f,{class:"max-w-[300px]",ref:a,model:e,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:i,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},c(S,{label:"新密码",required:!0,path:"password"},c(I,{...pe,value:e.password,onInput:a=>{e.password=a},type:"password"})),c(S,{label:"重复密码",required:!0,path:"reenteredPassword"},c(I,{...pe,value:e.reenteredPassword,onInput:a=>{e.reenteredPassword=a},type:"password"})),c("div",{class:"w-full text-right"},c(q,{onClick:s,type:"primary",round:!0},"保存")))}));var we="_tab-user_9leer_1",ye="_avatar_9leer_3";const ge=p((()=>{const e=m({});let a;async function t(){const t=await l.api.master.get();e.value=K(t,["ok"]),a={...t}}d((async()=>{await t()}));const s=R(),n=y((()=>le(a,e.value))),o=async()=>{await l.api.master.patch({data:n.value}),s.success("保存成功~"),await t()};return()=>c(A,null,c(O,{cols:"1 400:1 600:2",class:we,xGap:20,yGap:20},c(F,null,c(f,{class:"flex flex-col justify-center items-center "},c(S,null,c("div",{class:ye},c(i,{src:e.value.avatar,size:200}))),c(S,{label:"上次登陆时间",class:"!mt-4"},c("div",{class:"text-center w-full"},c(V,null,e.value.lastLoginTime?c(Z,{time:e.value.lastLoginTime}):"N/A"))),c(S,{label:"上次登陆地址"},c("div",{class:"text-center w-full"},e.value.lastLoginIp?c(u,{trigger:"hover",ip:e.value.lastLoginIp,triggerEl:c(V,{class:"cursor-pointer"},e.value.lastLoginIp)}):"N/A")),c(S,null,c(q,{round:!0,class:"-mt-14",type:"primary",onClick:o,disabled:E(n.value)},"保存")))),c(F,null,c(f,null,c(S,{label:"主人名 (username)"},c(I,{value:e.value.username,onInput:a=>{e.value.username=a}})),c(S,{label:"主人昵称 (name)"},c(I,{value:e.value.name,onInput:a=>{e.value.name=a}})),c(S,{label:"主人邮箱 (mail)"},c(I,{value:e.value.mail,onInput:a=>{e.value.mail=a}})),c(S,{label:"个人首页"},c(I,{value:e.value.url,onInput:a=>{e.value.url=a}})),c(S,{label:"头像"},c(I,{value:e.value.avatar,onInput:a=>{e.value.avatar=a}})),c(S,{label:"个人介绍"},c(I,{value:e.value.introduce,onInput:a=>{e.value.introduce=a}}))))))}));var he,xe;(xe=he||(he={})).User="user",xe.System="system",xe.Security="security";var fe=p({setup(){const e=J(),a=D(),l=m(e.params.type);w((()=>e.params.type),(e=>{e&&(l.value=e)}));const t=m(null);return()=>c(r,{actionsElement:t.value},c(Q,{value:l.value,onUpdateValue:l=>{a.replace({...e,params:{...e.params,type:l}})}},c(X,{tab:"用户",name:he.User},c(ge,null)),c(X,{tab:"系统",name:he.System},c(de,null)),c(X,{tab:"安全",name:he.Security},c(ve,null))))}});export{fe as default};
