var e=Object.defineProperty,t=(t,a,l)=>(((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(t,"symbol"!=typeof a?a+"":a,l),l);import{V as a,b as l,I as o,u as n,E as s,M as r,P as i,S as u}from"./parse-button-552768f1-4a68e52.js";import{T as c}from"./TelegramPlane-1e8f9475-4a68e52.js";import{aR as d,d as p,b as v,aS as m,af as f,b5 as b,bd as g,ab as w,r as y,k as h,A as x,aT as C,w as S,o as k,B as j,l as P,h as D,a$ as T,b0 as z,b1 as U,b2 as M,aZ as O,G as $,bj as A,J as V,b4 as F,a_ as I,bk as q,bl as N,b3 as _,F as E,I as W,j as B,bc as R,Q as J,bm as L,b6 as Y,aF as Z}from"./vendor-96c780fc-4a68e52.js";import{H as K}from"./rounded-button-d3b148ff-4a68e52.js";import"./monaco-038acbdc-4a68e52.js";import{f as G,R as H,B as Q,a as X,d as ee,c as te}from"./index-4a68e52.js";import{u as ae}from"./use-parse-payload-a4fdbca4-4a68e52.js";import"./vue.runtime.esm-bundler-83798a28-4a68e52.js";var le={exports:{}};!function(e,t){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!("string"==typeof e||e instanceof String)){var t=a(e);throw null===e?t="null":"object"===t&&(t=e.constructor.name),new TypeError("Expected a string but received a ".concat(t))}},e.exports=t.default,e.exports.default=t.default}(le,le.exports);var oe={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,l.default)(e);var a=t.strictSeparator?n.test(e):o.test(e);return a&&t.strict?s(e):a};var a,l=(a=le.exports)&&a.__esModule?a:{default:a};var o=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,n=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,s=function(e){var t=e.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(t){var a=Number(t[1]),l=Number(t[2]);return a%4==0&&a%100!=0||a%400==0?l<=366:l<=365}var o=e.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),n=o[1],s=o[2],r=o[3],i=s?"0".concat(s).slice(-2):s,u=r?"0".concat(r).slice(-2):r,c=new Date("".concat(n,"-").concat(i||"01","-").concat(u||"01"));return!s||!r||c.getUTCFullYear()===n&&c.getUTCMonth()+1===s&&c.getUTCDate()===r};e.exports=t.default,e.exports.default=t.default}(oe,oe.exports);var ne=d(oe.exports);const se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},re=f("g",{fill:"none"},[f("path",{d:"M5.843 4.568a8.707 8.707 0 1 1 12.314 12.314l-1.187 1.174c-.875.858-2.01 1.962-3.406 3.312a2.25 2.25 0 0 1-3.128 0l-3.491-3.396c-.439-.431-.806-.794-1.102-1.09a8.707 8.707 0 0 1 0-12.314zm11.253 1.06A7.207 7.207 0 1 0 6.904 15.822L8.39 17.29a753.98 753.98 0 0 0 3.088 3a.75.75 0 0 0 1.043 0l3.394-3.3c.47-.461.863-.85 1.18-1.168a7.207 7.207 0 0 0 0-10.192zM12 7.999a3.002 3.002 0 1 1 0 6.004a3.002 3.002 0 0 1 0-6.003zm0 1.5a1.501 1.501 0 1 0 0 3.004a1.501 1.501 0 0 0 0-3.003z",fill:"currentColor"})],-1);var ie=p({name:"Location24Regular",render:function(e,t){return v(),m("svg",se,[re])}});const ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ce=f("g",{fill:"none"},[f("path",{d:"M10 2.75a7.25 7.25 0 0 1 5.63 11.819l4.9 4.9a.75.75 0 0 1-.976 1.134l-.084-.073l-4.901-4.9A7.25 7.25 0 1 1 10 2.75zm0 1.5a5.75 5.75 0 1 0 0 11.5a5.75 5.75 0 0 0 0-11.5z",fill:"currentColor"})],-1);var de=p({name:"Search24Regular",render:function(e,t){return v(),m("svg",ue,[ce])}});const pe=["开心","伤心","决心","坚定","痛恨","生气","悲哀","痛苦","可怕","不快","可恶","担心","绝望","焦虑","激动"],ve=["晴","多云","雨","阴","雪","雷雨"];var me,fe,be=Object.defineProperty,ge=Object.getOwnPropertyDescriptor,we=(e,t,a,l)=>{for(var o,n=l>1?void 0:l?ge(t,a):t,s=e.length-1;s>=0;s--)(o=e[s])&&(n=(l?o(t,a,n):o(n))||n);return l&&n&&be(t,a,n),n};class ye{constructor(){t(this,"savedTime"),t(this,"text"),t(this,"title")}}we([a({name:"isIso8601",constraints:[me],validator:{validate:function(e,t){return function(e,t){return"string"==typeof e&&ne(e,t)}(e,t.constraints[0])},defaultMessage:l((function(e){return e+"$property must be a valid ISO 8601 date string"}),fe)}},fe)],ye.prototype,"savedTime",2),we([o()],ye.prototype,"text",2),we([o()],ye.prototype,"title",2);const he=p((()=>{const e=w(),t=y("写点什么呢"),a=h((()=>e.query.id));x((()=>{if(a.value)return;const e=new Date;t.value=`记录 ${e.getFullYear()} 年第 ${G(e)} 天`}));const l=C({text:"",title:"",hide:!1,hasMemory:!1,mood:"",music:[],password:null,secret:null,weather:"",location:"",coordinates:null}),o=y(),d=h((()=>!(!a.value||l.title))),p=S((()=>d.value),(e=>{if(e)return;const t=((e,t,a)=>{let l;const{storage:o,reset:s,clear:r}=n(ye,"auto-save-"+e,!1);let i=a();const u=()=>{const{text:e,title:t}=a();(e||t)&&(i.text==e&&i.title==t||(i={text:e,title:t},Object.assign(o,{savedTime:(new Date).toISOString(),text:e,title:t}),console.log("saved data: ",o)))};function c(){clearInterval(l)}return{reset:s,getPrevSaved:()=>({...b(o)}),save:u,track(){c(),u(),l=setInterval(u,t)},disposer:c,clearSaved:r}})("note-"+(a.value||"new"),3e3,(()=>({text:l.text,title:l.title})));((e,t)=>{const{disposer:a,clearSaved:l,getPrevSaved:o,reset:n,save:s,track:r}=t,i=window.dialog;(async()=>{const t=o();console.log("prev saved: ",t),!t.text&&!t.title||t.text===e.text&&t.title===e.title||requestAnimationFrame((()=>{i.info({title:"发现有未保存的内容, 是否还原?",negativeText:"不用啦",positiveText:"嗯",onPositiveClick(){Object.assign(e,{text:t.text,title:t.title})}})}))})(),r(),g((()=>{s(),a()}))})(l,t),requestAnimationFrame((()=>{p()}))}),{immediate:!0});k((async()=>{const e=a.value;if(e&&"string"==typeof e){const a=(await H.api.notes(e).get({params:{single:!0}})).data;o.value=a.nid,a.secret=a.secret?new Date(a.secret):null;const n=new Date(a.created);t.value=`记录 ${n.getFullYear()} 年第 ${G(n)} 天`,(e=>{ae(l)(e)})(a)}}));const v=y(!1),m=j(),f=P(),B=h((()=>"string"==typeof l.password)),R=async()=>{const e=()=>({...b(l),title:l.title&&l.title.trim()?l.title.trim():t.value,password:l.password&&l.password.length>0?l.password:null,secret:l.secret?(()=>{const e=new Date(l.secret);return+e-+new Date<=0?null:e})():null,music:l.music});if(a.value){if(!Y(a.value))return;const t=a.value;await H.api.notes(t).put({data:e()}),m.success("修改成功")}else await H.api.notes.post({data:e()}),m.success("发布成功");f.push({name:ee.ViewNote,hash:"|publish"})};return()=>{var e;return D(X,{title:"树洞",actionsElement:D(E,null,D(i,{data:l}),D(K,{icon:D(c,null),onClick:R})),footerButtonElement:D(E,null,D("button",{onClick:()=>{v.value=!0}},D(W,null,D(u,null))))},D(r,{class:"mt-3 relative z-10",label:t.value,value:l.title,onChange:e=>{l.title=e}}),D("div",{class:"text-gray-500 py-3"},D("label",null,`${Q}/notes/${null!=(e=o.value)?e:""}`)),D(s,{loading:d.value,onChange:e=>{l.text=e},text:l.text}),D(T,{show:v.value,width:450,style:{maxWidth:"90vw"},placement:"right",onUpdateShow:e=>{v.value=e}},D(z,{title:"文章设定"},D(U,{name:"note-options"},D(M,{label:"心情",required:!0},D(O,{value:l.mood,filterable:!0,tag:!0,options:pe.map((e=>({label:e,value:e}))),onUpdateValue:e=>{l.mood=e}})),D(M,{label:"天气",required:!0},D(O,{value:l.weather,filterable:!0,tag:!0,options:ve.map((e=>({label:e,value:e}))),onUpdateValue:e=>{l.weather=e}})),D(M,{label:"获取当前地址",labelPlacement:"left"},D($,{vertical:!0},D(A,null,D(xe,{onChange:(e,t)=>{l.location=e.formattedAddress,l.coordinates={longitude:t[0],latitude:t[1]}}}),D(Ce,{placeholder:l.location,onChange:(e,t)=>{l.location=e,l.coordinates=t}}),D(V,{round:!0,disabled:!l.location,onClick:()=>{l.location="",l.coordinates=null}},"清楚")),D($,{vertical:!0},D("span",null,l.location),l.coordinates&&D("span",null,l.coordinates.longitude,", ",l.coordinates.latitude)))),D(M,{label:"设定密码?",labelAlign:"right",labelPlacement:"left"},D(F,{value:B.value,onUpdateValue:e=>{l.password=e?"":null}})),B.value&&D(M,{label:"输入密码"},D(I,{disabled:!B.value,placeholder:"",type:"password",value:l.password,inputProps:{name:"note-password",autocapitalize:"off",autocomplete:"new-password"},onInput:e=>{l.password=e}})),D(M,{label:"多久之后公开",labelWidth:"50%",labelAlign:"right",labelPlacement:"left"},D(q,{type:"datetime",isDateDisabled:e=>+new Date(e)-+new Date<0,placeholder:"选择时间",value:l.secret,onUpdateValue:e=>{l.secret=e?new Date(e):null}},{footer:()=>{const e=new Date;return D($,null,D(V,{round:!0,type:"default",size:"small",onClick:()=>{l.secret=N(e,{days:1})}},"一天后"),D(V,{round:!0,type:"default",size:"small",onClick:()=>{l.secret=N(e,{weeks:1})}},"一周后"),D(V,{round:!0,type:"default",size:"small",onClick:()=>{l.secret=N(e,{days:14})}},"半个月后"),D(V,{round:!0,type:"default",size:"small",onClick:()=>{l.secret=N(e,{months:1})}},"一个月后"))}})),D(M,{label:"隐藏",labelWidth:"50%",labelAlign:"right",labelPlacement:"left"},D(F,{value:l.hide,onUpdateValue:e=>{l.hide=e}})),D(M,{label:"是否存在回忆, 日后需要重温?",labelAlign:"right",labelPlacement:"left",labelWidth:"50%"},D(F,{value:l.hasMemory,onUpdateValue:e=>{l.hasMemory=e}})),D(M,{label:"音乐 (网易云 ID)"},D(_,{value:l.music.map((e=>e.id)),onUpdateValue:e=>{l.music=e.map((e=>({type:"netease",id:e})))}}))))))}})),xe=p({props:{onChange:{type:Function,required:!0}},setup(e){const t=j(),a=y(!1),l=async()=>{if(navigator.geolocation)try{const t=await new Promise(((e,t)=>{navigator.geolocation.getCurrentPosition((t=>{a.value=!0,e(t),a.value=!1}),(e=>{a.value=!1,t(e)}))})),{coords:{latitude:l,longitude:o}}=t,n=[o,l],s=await fetch("https://restapi.amap.com/v3/geocode/regeo?key="+te.amapKey+"&location="+n.join(",")),r=Z(await s.json(),{deep:!0});e.onChange(r.regeocode,n)}catch(l){t.error("定位权限未打开")}else t.error("浏览器不支持定位")};return()=>D(V,{ghost:!0,round:!0,type:"primary",onClick:l,loading:a.value},{icon:()=>D(W,null,D(ie,null)),default:()=>"定位"})}}),Ce=p({props:{placeholder:{type:String,default:""},onChange:{type:Function,required:!0}},setup(e){j();const t=y(!1),a=y(!1),l=y(""),o=y([]);let n;return S((()=>l.value),B((async e=>{t.value=!0;const a=await(async e=>{const t=new URLSearchParams([["key",te.amapKey],["keywords",e.replace(/\s/g,"|")]]),a=await fetch("https://restapi.amap.com/v3/place/text?"+t.toString());return await a.json()})(e);o.value=[],a.pois.forEach((e=>{const t=e.cityname+e.adname+e.address+e.name,[a,l]=e.location.split(",").map(Number);o.value.push({key:e.cityname,label:t,value:JSON.stringify([t,{latitude:l,longitude:a}])})})),t.value=!1}),400,{trailing:!0,leading:!0})),()=>D(E,null,D(V,{ghost:!0,round:!0,onClick:()=>{a.value=!0}},{icon:()=>D(W,null,D(de,null)),default:()=>"自定义"}),D(R,{show:a.value,onUpdateShow:e=>{a.value=e}},D(J,{class:"modal-card sm",bordered:!1,closable:!0,onClose:()=>{a.value=!1},title:"搜索关键字查找地点"},{default:()=>D(E,null,D(U,{labelPlacement:"top"},D(M,{label:"搜索地点"},D(L,{placeholder:e.placeholder||"",onSelect:e=>{n=e},options:o.value,loading:t.value,onUpdateValue:e=>{l.value=e},value:l.value}))),D($,{justify:"end"},D(V,{round:!0,type:"primary",onClick:()=>{const t=JSON.parse(n);e.onChange.apply(this,t),a.value=!1},disabled:t.value},"确定")))})))}});export{he as default};
//# sourceMappingURL=write-54624f05-4a68e52.js.map
