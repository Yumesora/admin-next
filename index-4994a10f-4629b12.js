import{u as e,R as a,U as l,p as t,j as s,e as n,_ as o,I as u,a as r}from"./index-4629b12.js";import{d as i,o as p,h as d,x as c,r as v,bv as m,w as b,A as w,k as y,aP as k,bw as f,bx as g,aZ as h,D as x,by as O,aW as I,a_ as U,a$ as S,b0 as C,b7 as P,O as T,G as V,F as _,bu as j,aQ as N,bz as z,b1 as K,aU as L,aS as A,J as D,I as E,b9 as G,Q as q,bh as B,n as H,l as M,B as R,E as W,aa as Q,p as F,bm as J,bn as Z,i as $}from"./vendor-50b27d4b-4629b12.js";import{P as X}from"./Plus-182160c5-4629b12.js";import{R as Y}from"./relative-time-8a22f15c-4629b12.js";import{r as ee}from"./vue.runtime.esm-bundler-125a3c87-4629b12.js";import{H as ae}from"./rounded-button-efb29095-4629b12.js";import{d as le,s as te}from"./index-4fd3b79c-4629b12.js";var se={};Object.defineProperty(se,"__esModule",{value:!0});const ne=ee,oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ue=ne.createVNode("path",{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0 0 51.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z",fill:"currentColor"},null,-1),re=ne.createVNode("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1);var ie=se.default=ne.defineComponent({name:"CheckCircleOutlined",render:function(e,a){return ne.openBlock(),ne.createBlock("svg",oe,[ue,re])}});const pe={class:"mt-6",labelPlacement:"left",labelAlign:"right",labelWidth:150},de={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},ce=i((()=>{const t=he();p((()=>{t.value=d(ae,{disabled:!0,onClick:u,icon:d(ie,null)})})),c((()=>{t.value=null}));let s={};const n=v(ve({})),o=v({});async function u(){if(j(o.value))return;const e=Object.entries(o.value);for await(const[l,t]of e)"seo"===l?await a.api.options(l).patch({data:{...t,keywords:n.value.seo.keywords}}):await a.api.options(l).patch({data:t});await r(),message.success("修改成功")}b((()=>n.value),(e=>{o.value=le(s,K(e))}),{deep:!0}),b((()=>o.value),(e=>{let a=!1;a=!j(e),t.value=d(ae,{disabled:!a,icon:d(ie,null),onClick:u})}));const r=async()=>{let e=await a.api.options.get();e=ve(N(e,["ok"])),s=z(e),n.value=e};w((()=>{r()}));const i=v(["website"]),m=e(l),L=y((()=>m.viewport.value.mobile?1:2)),A=k(pe);return b((()=>m.viewport.value.mobile),(e=>{A.labelPlacement=e?"top":"left"})),()=>d(_,null,d("div",{class:"pt-4"}),d(f,{accordion:!0,displayDirective:"if",expandedNames:i.value,onUpdateExpandedNames:e=>{i.value=e}},d(g,{title:"网站设置",name:"website"},d(h,{...A},d(x,{cols:L.value,xGap:12},d(O,{span:1,label:"前端地址"},d(I,{value:n.value.url.webUrl,onInput:e=>{n.value.url.webUrl=e}})),d(O,{span:1,label:"API 地址"},d(I,{value:n.value.url.serverUrl,onInput:e=>{n.value.url.serverUrl=e}})),d(O,{span:1,label:"后台地址"},d(I,{value:n.value.url.adminUrl,onInput:e=>{n.value.url.adminUrl=e}})),d(O,{span:1,label:"Gateway 地址"},d(I,{value:n.value.url.wsUrl,onInput:e=>{n.value.url.wsUrl=e}}))))),d(g,{title:"SEO 优化",name:"seo"},d(h,{...A},d(U,{label:"网站标题"},d(I,{...de,value:n.value.seo.title,onInput:e=>{n.value.seo.title=e}})),d(U,{label:"网站描述"},d(I,{...de,value:n.value.seo.description,onInput:e=>{n.value.seo.description=e}})),d(U,{label:"关键字"},d(S,{round:!0,type:"primary",value:n.value.seo.keywords,onChange:e=>{n.value.seo.keywords=e}})))),d(g,{title:"评论设置",name:"comment"},d(h,{...A},d(U,{label:"反垃圾评论"},d(C,{value:n.value.commentOptions.antiSpam,onUpdateValue:e=>{n.value.commentOptions.antiSpam=e}})),d(U,{label:"自定义屏蔽关键词"},d(S,{disabled:!n.value.commentOptions.antiSpam,value:n.value.commentOptions.spamKeywords,onUpdateValue:e=>{n.value.commentOptions.spamKeywords=e},type:"primary"})),d(U,{label:"自定义屏蔽 IP"},d(S,{disabled:!n.value.commentOptions.antiSpam,value:n.value.commentOptions.blockIps,onUpdateValue:e=>{n.value.commentOptions.blockIps=e}})),d(U,{label:"禁止非中文评论"},d(C,{value:n.value.commentOptions.disableNoChinese,onUpdateValue:e=>{n.value.commentOptions.disableNoChinese=e}})))),d(g,{title:"评论回复设置",name:"reply"},d(h,{...A},d(U,{label:"开启评论邮箱提醒"},d(C,{value:n.value.mailOptions.enable,onUpdateValue:e=>{n.value.mailOptions.enable=e}})),d(x,{cols:L.value,xGap:12},d(O,{span:1,label:"发件邮箱 host"},d(I,{value:n.value.mailOptions.options.host,onInput:e=>{n.value.mailOptions.options.host=e}})),d(O,{span:1,label:"发件邮箱端口"},d(P,{value:n.value.mailOptions.options.port,onChange:e=>{n.value.mailOptions.options.port=null!=e?e:465}})),d(O,{span:1,label:"发件邮箱地址"},d(I,{value:n.value.mailOptions.user,onInput:e=>{n.value.mailOptions.user=e}})),d(O,{span:1,label:"发件邮箱密码"},d(I,{type:"password",showPasswordToggle:!0,inputProps:{name:"email-password",autocomplete:"off",autocapitalize:"off",autocorrect:"off"},value:n.value.mailOptions.pass,onInput:e=>{n.value.mailOptions.pass=e}}))))),d(g,{name:"img_bed",title:"图床设定"},d(h,{...A},d(T,null,"TODO"))),d(g,{name:"backup",title:"备份"},d(h,{...A},d(U,{label:"开启备份"},d(V,{vertical:!0},d(C,{value:n.value.backupOptions.enable,onUpdateValue:e=>{n.value.backupOptions.enable=e}}),d(T,{class:"text-xs",depth:3},"仅支持备份到 COS"))),d(U,{label:"地域 Region"},d(I,{...de,value:n.value.backupOptions.region,onInput:e=>{n.value.backupOptions.region=e}})),d(U,{label:"SecretId"},d(I,{...de,value:n.value.backupOptions.secretId,onInput:e=>{n.value.backupOptions.secretId=e}})),d(U,{label:"SecretKey"},d(I,{...de,type:"password",inputProps:{name:"secret-key-password",autocomplete:"off",autocapitalize:"off",autocorrect:"off"},showPasswordToggle:!0,value:n.value.backupOptions.secretKey,onInput:e=>{n.value.backupOptions.secretKey=e}})))),d(g,{name:"baidu_push",title:"百度推送"},d(h,{...A},d(U,{label:"开启推送"},d(C,{value:n.value.baiduSearchOptions.enable,onUpdateValue:e=>{n.value.baiduSearchOptions.enable=e}})),d(U,{label:"Token",path:"baidu_push"},d(I,{...de,showPasswordToggle:!0,type:"password",inputProps:{name:"baidu-push-password",autocomplete:"off",autocapitalize:"off",autocorrect:"off"},disabled:!n.value.baiduSearchOptions.enable,value:n.value.baiduSearchOptions.token,onUpdateValue:e=>{n.value.baiduSearchOptions.token=e}}))))))}));function ve(e){return m({seo:{title:"",description:"",keywords:[]},url:{wsUrl:"",adminUrl:"",serverUrl:"",webUrl:""},imageBed:{customUrl:"",repo:"",token:"",type:"github"},mailOptions:{user:"",pass:"",options:{host:"",port:465},enable:!1},commentOptions:{antiSpam:!1,spamKeywords:[],blockIps:[],disableNoChinese:!1},backupOptions:{enable:!1,secretId:"",secretKey:"",bucket:"",region:""},baiduSearchOptions:{enable:!1,token:""}},e)}const me=i((()=>(he(),()=>d(_,null,d("div",{class:"pt-4"}),d(f,{defaultExpandedNames:["reset"],displayDirective:"if"},d(g,{name:"reset",title:"修改密码"},d(we,null)),d(g,{name:"token",title:"API Token"},d(be,null))))))),be=i((()=>{const e=v([]),l=()=>({name:"",expired:!1,expiredTime:new Date}),s=k(l()),n=async()=>{const{data:l}=await a.api.auth.token.get();e.value=l};w((()=>{n()}));const o=v(!1),u=async()=>{const t={name:s.name,expired:s.expired?s.expiredTime.toISOString():void 0},u=await a.api.auth.token.post({data:t});await navigator.clipboard.writeText(u.token),o.value=!1;const r=l();for(const e in r)s[e]=r[e];message.success("生成成功, Token 已复制, "+u.token),await n();const i=e.value.findIndex((e=>e.name===t.name));-1!==i&&(e.value[i].token=u.token)};return()=>d(H,{class:"!overflow-visible"},d(G,{show:o.value,onUpdateShow:e=>{o.value=e}},d(q,{bordered:!1,title:"创建 Token",class:"max-w-full w-[500px]"},d(h,null,d(U,{label:"名称",required:!0},d(I,{value:s.name,onInput:e=>{s.name=e}})),d(U,{label:"是否过期"},d(C,{value:s.expired,onUpdateValue:e=>{s.expired=e}})),d(U,{label:"过期时间"},d(B,{disabled:!s.expired,value:s.expiredTime,type:"datetime",onUpdateValue:e=>{s.expiredTime=new Date(e)}}))),d(V,null,d(D,{round:!0,onClick:()=>{o.value=!1}},"取消"),d(D,{round:!0,type:"primary",onClick:u},"确定")))),d(D,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{o.value=!0}},d(E,null,d(X,null)),d("span",{class:"ml-2"},"新增")),d(L,{remote:!0,bordered:!1,data:e.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render:({token:e})=>null!=e?e:"*".repeat(40)},{title:"创建时间",key:"created",render:({created:e})=>d(Y,{time:e})},{title:"过期时间",key:"expired",render:({expired:e})=>t(e,"yyyy年M月d日 HH:mm:ss")},{title:"操作",key:"id",render:({id:l,name:t})=>d(V,null,d(A,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{(async l=>{await a.api.auth.token.delete({params:{id:l}}),message.success("删除成功");const t=e.value.findIndex((e=>e.id===l));-1!=t&&e.value.splice(t,1)})(l)}},{trigger:()=>d(D,{text:!0,type:"error"},"删除"),default:()=>d("span",{style:{maxWidth:"12rem"}},'确定要删除 Token "',t,'"?')}))}]}))})),we=i((()=>{const e=k({password:"",reenteredPassword:""}),l=v(),t=M(),o=async()=>{l.value&&l.value.validate((async l=>{l?console.log(l):(await a.api.master.patch({data:{password:e.password}}),message.success("更改成功"),s(),t.push({name:n.Login}))}))};function u(a,l){return console.log(a),l===e.password}return()=>d(h,{class:"max-w-[300px]",ref:l,model:e,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:u,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},d(U,{label:"新密码",required:!0,path:"password"},d(I,{...de,value:e.password,onInput:a=>{e.password=a},type:"password"})),d(U,{label:"重复密码",required:!0,path:"reenteredPassword"},d(I,{...de,value:e.reenteredPassword,onInput:a=>{e.reenteredPassword=a},type:"password"})),d("div",{class:"w-full text-right"},d(D,{onClick:o,type:"primary",round:!0},"保存")))}));var ye="_tab-user_9leer_1",ke="_avatar_9leer_3";const fe=i((()=>{const e=v({});let l;async function t(){const t=await a.api.master.get();e.value=N(t,["ok"]),l={...t}}p((async()=>{await t()}));const s=R(),n=y((()=>te(l,e.value))),r=async()=>{await a.api.master.patch({data:n.value}),s.success("保存成功~"),await t()};return()=>d(_,null,d(x,{cols:2,class:ye,xGap:20,yGap:20},d(W,null,d(h,{class:"flex flex-col justify-center items-center "},d(U,null,d("div",{class:ke},d(o,{src:e.value.avatar,size:200}))),d(U,{label:"上次登陆时间",class:"!mt-4"},d("div",{class:"text-center w-full"},d(T,null,e.value.lastLoginTime?d(Y,{time:e.value.lastLoginTime}):"N/A"))),d(U,{label:"上次登陆地址"},d("div",{class:"text-center w-full"},e.value.lastLoginIp?d(u,{trigger:"hover",ip:e.value.lastLoginIp,triggerEl:d(T,{class:"cursor-pointer"},e.value.lastLoginIp)}):"N/A")),d(U,null,d(D,{round:!0,class:"-mt-14",type:"primary",onClick:r,disabled:j(n.value)},"保存")))),d(W,null,d(h,null,d(U,{label:"主人名 (username)"},d(I,{value:e.value.username,onInput:a=>{e.value.username=a}})),d(U,{label:"主人昵称 (name)"},d(I,{value:e.value.name,onInput:a=>{e.value.name=a}})),d(U,{label:"主人邮箱 (mail)"},d(I,{value:e.value.mail,onInput:a=>{e.value.mail=a}})),d(U,{label:"个人首页"},d(I,{value:e.value.url,onInput:a=>{e.value.url=a}})),d(U,{label:"头像"},d(I,{value:e.value.avatar,onInput:a=>{e.value.avatar=a}})),d(U,{label:"个人介绍"},d(I,{value:e.value.introduce,onInput:a=>{e.value.introduce=a}}))))))})),ge=Symbol("tab"),he=()=>$(ge);var xe,Oe;(Oe=xe||(xe={})).User="user",Oe.System="system",Oe.Security="security";var Ie=i({setup(){const e=Q(),a=M(),l=v(e.params.type);b((()=>e.params.type),(e=>{e&&(l.value=e)}));const t=v(null);return F(ge,t),()=>d(r,{actionsElement:t.value},d(J,{value:l.value,onUpdateValue:l=>{a.replace({...e,params:{...e.params,type:l}})}},d(Z,{tab:"用户",name:xe.User},d(fe,null)),d(Z,{tab:"系统",name:xe.System},d(ce,null)),d(Z,{tab:"安全",name:xe.Security},d(me,null))))}});export{Ie as default,he as useSystemHeaderAction};
//# sourceMappingURL=index-4994a10f-4629b12.js.map
