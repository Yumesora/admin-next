{"version":3,"file":"index-359baed0-005d83d.js","sources":["../src/views/setup/index.vue"],"sourcesContent":["<script lang=\"ts\">\nimport { useInjector } from 'hooks/use-deps-injection'\nimport { useMessage } from 'naive-ui'\nimport { defineComponent, ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport ParallaxButtonVue from '../../components/button/parallax-button.vue'\nimport { UserModel } from '../../models/user'\nimport { UserStore } from '../../stores/user'\nimport { RouteName } from '../../router/name'\nimport { RESTManager } from '../../utils/rest'\n\nconst bgUrl =\n  window.injectData.LOGIN_BG ||\n  (import.meta.env.VITE_APP_LOGIN_BG as string) ||\n  'https://gitee.com/xun7788/my-imagination/raw/master/uPic/1615516941397.jpg'\nexport const InitView = defineComponent({\n  components: { ParallaxButtonVue },\n  setup() {\n    const loaded = ref(false)\n    const { updateToken, fetchUser } = useInjector(UserStore)\n    onMounted(() => {\n      const $$ = new Image()\n      $$.src = bgUrl\n      $$.onload = (e) => {\n        loaded.value = true\n      }\n    })\n    const toast = useMessage()\n\n    const password = ref('')\n    const username = ref('')\n\n    const handleRegister = async (e: Event) => {\n      e?.stopPropagation()\n      try {\n        const res = await RESTManager.api.master.register.post<{\n          token: string & UserModel\n        }>({\n          data: {\n            username: username.value,\n            password: password.value,\n          },\n        })\n        updateToken(res.token)\n\n        toast.success('欧尼酱!')\n        const router = useRouter()\n        setTimeout(() => {\n          fetchUser().then(() => {\n            router.push({\n              name: RouteName.System,\n            })\n          })\n        }, 300)\n      } catch (e: any) {\n        toast.error('出了点小问题, 不要慌')\n        toast.error(e.message)\n      }\n    }\n\n    return {\n      bgUrl,\n      loaded,\n\n      password,\n      handleRegister,\n\n      username,\n    }\n  },\n})\n\nexport default InitView\n</script>\n\n<template>\n  <div>\n    <div\n      class=\"bg transition-opacity duration-700\"\n      :style=\"{ backgroundImage: `url(${bgUrl})`, opacity: loaded ? 1 : 0 }\"\n    />\n\n    <div class=\"wrapper\">\n      <form action=\"#\" @submit.prevent=\"handleRegister\">\n        <div class=\"input-wrap\">\n          <input\n            v-model=\"username\"\n            autofocus\n            placeholder=\"这里填上你的用户名\"\n          />\n        </div>\n        <div class=\"input-wrap\">\n          <input\n            v-model=\"password\"\n            type=\"password\"\n            placeholder=\"这里填上密码哦\"\n          />\n        </div>\n        <ParallaxButtonVue\n          title=\"注册\"\n          class=\"p-button-raised p-button-rounded\"\n          @click.prevent.stop=\"handleRegister\"\n        />\n      </form>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n@import '../login/index.css';\n</style>\n<style scoped=\"\" lang=\"postcss\">\nform {\n  @apply px-[6.25rem] py-[3rem] bg-black bg-opacity-10 backdrop-blur-xl rounded-2xl;\n}\n\n.input-wrap {\n  margin: 1rem 0;\n  & input {\n    @apply bg-white bg-opacity-60;\n\n    padding: 3px 14px;\n    -webkit-text-fill-color: #333;\n    color: #333;\n    line-height: 1.8;\n    backdrop-filter: blur(24px);\n  }\n\n  & * {\n    outline: none;\n  }\n}\n\n.password {\n  @apply !mb-4;\n}\n</style>\n"],"names":["bgUrl","window","injectData","LOGIN_BG","InitView","defineComponent","components","ParallaxButtonVue","setup","loaded","ref","updateToken","fetchUser","useInjector","UserStore","$$","Image","src","onload","e","value","toast","useMessage","password","username","handleRegister","async","stopPropagation","res","RESTManager","api","master","register","post","data","token","success","router","useRouter","then","push","name","RouteName","System","e2","error","message","_sfc_main","class","_openBlock","_createElementBlock","_hoisted_1","action","_cache","autofocus","type","_component_ParallaxButtonVue","title"],"mappings":"2OAWA,MAAMA,EACJC,OAAOC,WAAWC,UACjB,6EAEUC,EAAWC,EAAgB,CACtCC,WAAY,CAAEC,kBAAAA,GACdC,cACQC,EAASC,GAAI,IACbC,YAAEA,YAAaC,GAAcC,EAAYC,MACrC,WACFC,EAAK,IAAIC,QACZC,IAAMjB,IACNkB,OAAUC,MACJC,OAAQ,YAGbC,EAAQC,IAERC,EAAWb,EAAI,IACfc,EAAWd,EAAI,UA8Bd,CACLV,MAAAA,EACAS,OAAAA,EAEAc,SAAAA,EACAE,eAjCqBC,MAAOP,eACzBQ,4BAEKC,QAAYC,EAAYC,IAAIC,OAAOC,SAASC,KAE/C,CACDC,KAAM,CACJV,SAAUA,EAASJ,MACnBG,SAAUA,EAASH,WAGXQ,EAAIO,SAEVC,QAAQ,cACRC,EAASC,gBACJ,SACGC,MAAK,OACRC,KAAK,CACVC,KAAMC,EAAUC,cAGnB,WACIC,KACDC,MAAM,iBACNA,MAAMD,EAAEE,WAWhBtB,SAAAA,MAKDuB,EAAa3C,gCAYL4C,MAAM,cAONA,MAAM,0HAdfC,IAGEC,gBAFM,OACLF,MAAK,wGAGR,UACE,MAoBOG,KApBS,QAAEC,OAAM,6FACtB,GACE,QAIE,cAFA,sBAASC,6BACTC,UAAW,4DAIb,QAIE,cAFA,sBAAeD,6BACfE,uEAIQC,GACVC,MAAM,KACLT,MAAK"}