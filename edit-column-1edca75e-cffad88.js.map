{"version":3,"file":"edit-column-1edca75e-cffad88.js","sources":["../src/components/table/edit-column.tsx"],"sourcesContent":["import { defineComponent } from 'vue'\nimport { NInput, NSelect, NSpace, useMessage } from 'naive-ui'\nimport { PropType, ref, watch } from 'vue'\nimport { useInjector } from 'hooks/use-deps-injection'\nimport { CategoryStore } from 'stores/category'\nimport { SelectMixedOption } from 'naive-ui/lib/select/src/interface'\n\nexport const EditColumn = defineComponent({\n  props: {\n    initialValue: {\n      type: String,\n      required: true,\n    },\n    onSubmit: {\n      type: Function as PropType<(value: string) => void>,\n      required: true,\n    },\n    placeholder: {\n      type: String,\n    },\n\n    type: {\n      type: String as PropType<'input' | 'select'>,\n      default: 'input',\n    },\n    options: {\n      type: Array as PropType<SelectMixedOption[]>,\n      default: () => [],\n    },\n  },\n  setup(props) {\n    const value = ref(props.initialValue)\n\n    watch(\n      () => props.initialValue,\n      (n) => {\n        value.value = n\n      },\n    )\n\n    const isEdit = ref(false)\n    const inputRef = ref<HTMLInputElement>()\n    const message = useMessage()\n    watch(\n      () => isEdit.value,\n      (n) => {\n        if (n) {\n          message.info('回车以完成修改', { duration: 1500 })\n          requestAnimationFrame(() => {\n            inputRef.value?.focus()\n          })\n        }\n      },\n    )\n    const handleSubmit = () => {\n      props.onSubmit(value.value)\n      isEdit.value = false\n    }\n    const categoryStore = useInjector(CategoryStore)\n    return () => (\n      <>\n        {isEdit.value ? (\n          <div class=\"flex items-center w-full relative flex-nowrap\">\n            {(() => {\n              switch (props.type) {\n                case 'input': {\n                  return (\n                    <NInput\n                      onKeydown={(e) => {\n                        if (e.key == 'Enter') {\n                          handleSubmit()\n                        }\n                      }}\n                      class=\"w-3/4\"\n                      value={value.value}\n                      placeholder={props.placeholder ?? props.initialValue}\n                      size=\"tiny\"\n                      autofocus\n                      ref={inputRef}\n                      onBlur={() => {\n                        isEdit.value = false\n                      }}\n                      onInput={(e) => {\n                        value.value = e\n                      }}\n                    ></NInput>\n                  )\n                }\n                case 'select': {\n                  return (\n                    <NSelect\n                      class=\"w-full\"\n                      placeholder={props.placeholder ?? props.initialValue}\n                      value={value.value}\n                      onUpdateValue={(e) => {\n                        value.value = e\n                        handleSubmit()\n                      }}\n                      onBlur={() => {\n                        isEdit.value = false\n                      }}\n                      options={props.options}\n                    ></NSelect>\n                  )\n                }\n              }\n            })()}\n          </div>\n        ) : (\n          <button\n            class=\"w-full text-left\"\n            onClick={() => {\n              isEdit.value = true\n            }}\n          >\n            {props.initialValue}&nbsp;\n          </button>\n        )}\n      </>\n    )\n  },\n})\n"],"names":["EditColumn","defineComponent","props","initialValue","type","String","required","onSubmit","Function","placeholder","default","options","Array","setup","value","ref","n","isEdit","inputRef","message","useMessage","info","duration","focus","handleSubmit","CategoryStore","class","NInput","onKeydown","e","key","size","autofocus","onBlur","onInput","NSelect","onUpdateValue","onClick"],"mappings":"wJAOaA,EAAaC,EAAgB,CACxCC,MAAO,CACLC,aAAc,CACZC,KAAMC,OACNC,UAAU,GAEZC,SAAU,CACRH,KAAMI,SACNF,UAAU,GAEZG,YAAa,CACXL,KAAMC,QAGRD,KAAM,CACJA,KAAMC,OACNK,QAAS,SAEXC,QAAS,CACPP,KAAMQ,MACNF,QAAS,IAAM,KAGnBG,MAAMX,SACEY,EAAQC,EAAIb,EAAMC,iBAGtB,IAAMD,EAAMC,eACXa,MACOF,MAAQE,WAIZC,EAASF,GAAI,GACbG,EAAWH,IACXI,EAAUC,OAEd,IAAMH,EAAOH,QACZE,IACKA,MACMK,KAAK,UAAW,CAAEC,SAAU,8BACd,sBACXR,UAAOS,qBAKlBC,EAAe,OACbjB,SAASO,EAAMA,SACdA,OAAQ,YAEiBW,GAC3B,aAEFR,EAAOH,QACL,MAAD,CAAKY,MAAM,sEAECxB,EAAME,UACP,iBAEAuB,EAAD,CACEC,UAAYC,IACG,SAATA,EAAEC,UAIRJ,MAAM,QACNZ,MAAOA,EAAMA,MACbL,YAAa,WAAMA,eAAeP,EAAMC,aACxC4B,KAAK,OACLC,WAAS,EACTjB,IAAKG,EACLe,OAAQ,OACCnB,OAAQ,GAEjBoB,QAAUL,MACFf,MAAQe,SAKjB,kBAEAM,EAAD,CACET,MAAM,SACNjB,YAAa,WAAMA,eAAeP,EAAMC,aACxCW,MAAOA,EAAMA,MACbsB,cAAgBP,MACRf,MAAQe,OAGhBI,OAAQ,OACCnB,OAAQ,GAEjBH,QAAST,EAAMS,kBAQ1B,SAAD,CACEe,MAAM,mBACNW,QAAS,OACAvB,OAAQ,IAGhBZ,EAAMC,aAAa"}