import{V as e,b as t,I as a,u as l,E as o,M as n,P as s,S as r}from"./parse-button-c0597c1d-2_19_59.js";import{T as i}from"./TelegramPlane-741a88f6-2_19_59.js";import{b4 as u,d as c,b as d,e as p,f as v,b1 as m,ba as f,aa as g,r as b,k as w,A as h,aP as y,w as x,o as C,B as S,l as k,h as _,aX as j,aY as P,aZ as D,a_ as z,aV as U,G as T,bg as M,J as O,b0 as $,aW as A,bh as V,bi as I,a$ as F,F as q,I as N,j as W,b9 as E,Q as B,bj as R,b2 as Y,v as J}from"./vendor-a3bf3ad0-2_19_59.js";import{H as L}from"./rounded-button-00a9564c-2_19_59.js";import"./monaco-2cb49779-2_19_59.js";import{h as Z,R as K,B as G,a as H,e as Q,c as X}from"./index-2_19_59.js";import{u as ee}from"./use-parse-payload-770fb8f3-2_19_59.js";import"./vue.runtime.esm-bundler-dad87c3e-2_19_59.js";var te={exports:{}};!function(e,t){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!("string"==typeof e||e instanceof String)){var t=a(e);throw null===e?t="null":"object"===t&&(t=e.constructor.name),new TypeError("Expected a string but received a ".concat(t))}},e.exports=t.default,e.exports.default=t.default}(te,te.exports);var ae={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,l.default)(e);var a=t.strictSeparator?n.test(e):o.test(e);return a&&t.strict?s(e):a};var a,l=(a=te.exports)&&a.__esModule?a:{default:a};var o=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,n=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,s=function(e){var t=e.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(t){var a=Number(t[1]),l=Number(t[2]);return a%4==0&&a%100!=0||a%400==0?l<=366:l<=365}var o=e.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),n=o[1],s=o[2],r=o[3],i=s?"0".concat(s).slice(-2):s,u=r?"0".concat(r).slice(-2):r,c=new Date("".concat(n,"-").concat(i||"01","-").concat(u||"01"));return!s||!r||c.getUTCFullYear()===n&&c.getUTCMonth()+1===s&&c.getUTCDate()===r};e.exports=t.default,e.exports.default=t.default}(ae,ae.exports);var le=u(ae.exports);const oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ne=v("g",{fill:"none"},[v("path",{d:"M10 2.75a7.25 7.25 0 0 1 5.63 11.819l4.9 4.9a.75.75 0 0 1-.976 1.134l-.084-.073l-4.901-4.9A7.25 7.25 0 1 1 10 2.75zm0 1.5a5.75 5.75 0 1 0 0 11.5a5.75 5.75 0 0 0 0-11.5z",fill:"currentColor"})],-1);var se=c({name:"Search24Regular",render:function(e,t){return d(),p("svg",oe,[ne])}});const re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ie=v("g",{fill:"none"},[v("path",{d:"M5.843 4.568a8.707 8.707 0 1 1 12.314 12.314l-1.187 1.174c-.875.858-2.01 1.962-3.406 3.312a2.25 2.25 0 0 1-3.128 0l-3.491-3.396c-.439-.431-.806-.794-1.102-1.09a8.707 8.707 0 0 1 0-12.314zm11.253 1.06A7.207 7.207 0 1 0 6.904 15.822L8.39 17.29a753.98 753.98 0 0 0 3.088 3a.75.75 0 0 0 1.043 0l3.394-3.3c.47-.461.863-.85 1.18-1.168a7.207 7.207 0 0 0 0-10.192zM12 7.999a3.002 3.002 0 1 1 0 6.004a3.002 3.002 0 0 1 0-6.003zm0 1.5a1.501 1.501 0 1 0 0 3.004a1.501 1.501 0 0 0 0-3.003z",fill:"currentColor"})],-1);var ue=c({name:"Location24Regular",render:function(e,t){return d(),p("svg",re,[ie])}});const ce=["开心","伤心","决心","坚定","痛恨","生气","悲哀","痛苦","可怕","不快","可恶","担心","绝望","焦虑","激动"],de=["晴","多云","雨","阴","雪","雷雨"];var pe,ve,me=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,ge=(e,t,a,l)=>{for(var o,n=l>1?void 0:l?fe(t,a):t,s=e.length-1;s>=0;s--)(o=e[s])&&(n=(l?o(t,a,n):o(n))||n);return l&&n&&me(t,a,n),n};class be{}ge([e({name:"isIso8601",constraints:[pe],validator:{validate:function(e,t){return function(e,t){return"string"==typeof e&&le(e,t)}(e,t.constraints[0])},defaultMessage:t((function(e){return e+"$property must be a valid ISO 8601 date string"}),ve)}},ve)],be.prototype,"savedTime",2),ge([a()],be.prototype,"text",2),ge([a()],be.prototype,"title",2);const we=c((()=>{const e=g(),t=b("写点什么呢"),a=w((()=>e.query.id));h((()=>{if(a.value)return;const e=new Date;t.value=`记录 ${e.getFullYear()} 年第 ${Z(e)} 天`}));const u=y({text:"",title:"",hide:!1,hasMemory:!1,mood:"",music:[],password:null,secret:null,weather:"",location:"",coordinates:null}),c=b(),d=w((()=>!(!a.value||u.title))),p=x((()=>d.value),(e=>{if(e)return;const t=((e,t,a)=>{let o;const{storage:n,reset:s,clear:r}=l(be,"auto-save-"+e,!1);let i=a();const u=()=>{const{text:e,title:t}=a();(e||t)&&(i.text==e&&i.title==t||(i={text:e,title:t},Object.assign(n,{savedTime:(new Date).toISOString(),text:e,title:t}),console.log("saved data: ",n)))};function c(){clearInterval(o)}return{reset:s,getPrevSaved:()=>({...m(n)}),save:u,track(){c(),u(),o=setInterval(u,t)},disposer:c,clearSaved:r}})("note-"+(a.value||"new"),3e3,(()=>({text:u.text,title:u.title})));((e,t)=>{const{disposer:a,clearSaved:l,getPrevSaved:o,reset:n,save:s,track:r}=t,i=window.dialog;(async()=>{const t=o();console.log("prev saved: ",t),!t.text&&!t.title||t.text===e.text&&t.title===e.title||requestAnimationFrame((()=>{i.info({title:"发现有未保存的内容, 是否还原?",negativeText:"不用啦",positiveText:"嗯",onPositiveClick(){Object.assign(e,{text:t.text,title:t.title})}})}))})(),r(),f((()=>{s(),a()}))})(u,t),requestAnimationFrame((()=>{p()}))}),{immediate:!0});C((async()=>{const e=a.value;if(e&&"string"==typeof e){const a=(await K.api.notes(e).get({params:{single:!0}})).data;c.value=a.nid,a.secret=a.secret?new Date(a.secret):null;const l=new Date(a.created);t.value=`记录 ${l.getFullYear()} 年第 ${Z(l)} 天`,(e=>{ee(u)(e)})(a)}}));const v=b(!1),W=S(),E=k(),B=w((()=>"string"==typeof u.password)),R=async()=>{const e=()=>({...m(u),title:u.title&&u.title.trim()?u.title.trim():t,password:u.password&&u.password.length>0?u.password:null,secret:u.secret?(()=>{const e=new Date(u.secret);return+e-+new Date<=0?null:e})():null,music:u.music});if(a.value){if(!Y(a.value))return;const t=a.value;await K.api.notes(t).put({data:e()}),W.success("修改成功")}else await K.api.notes.post({data:e()}),W.success("发布成功");E.push({name:Q.ViewNote,hash:"|publish"})};return()=>{var e;return _(H,{title:"树洞",actionsElement:_(q,null,_(s,{data:u}),_(L,{icon:_(i,null),onClick:R})),footerButtonElement:_(q,null,_("button",{onClick:()=>{v.value=!0}},_(N,null,_(r,null))))},_(n,{class:"mt-3 relative z-10",label:t.value,value:u.title,onChange:e=>{u.title=e}}),_("div",{class:"text-gray-500 py-3"},_("label",null,`${G}/notes/${null!=(e=c.value)?e:""}`)),_(o,{loading:d.value,onChange:e=>{u.text=e},text:u.text}),_(j,{show:v.value,width:450,style:{maxWidth:"90vw"},placement:"right",onUpdateShow:e=>{v.value=e}},_(P,{title:"文章设定"},_(D,{name:"note-options"},_(z,{label:"心情",required:!0},_(U,{value:u.mood,filterable:!0,tag:!0,options:ce.map((e=>({label:e,value:e}))),onUpdateValue:e=>{u.mood=e}})),_(z,{label:"天气",required:!0},_(U,{value:u.weather,filterable:!0,tag:!0,options:de.map((e=>({label:e,value:e}))),onUpdateValue:e=>{u.weather=e}})),_(z,{label:"获取当前地址",labelPlacement:"left"},_(T,{vertical:!0},_(M,null,_(he,{onChange:(e,t)=>{u.location=e.formattedAddress,u.coordinates={longitude:t[0],latitude:t[1]}}}),_(ye,{placeholder:u.location,onChange:(e,t)=>{u.location=e,u.coordinates=t}}),_(O,{round:!0,disabled:!u.location,onClick:()=>{u.location="",u.coordinates=null}},"清楚")),_(T,{vertical:!0},_("span",null,u.location),u.coordinates&&_("span",null,u.coordinates.longitude,", ",u.coordinates.latitude)))),_(z,{label:"设定密码?",labelAlign:"right",labelPlacement:"left"},_($,{value:B.value,onUpdateValue:e=>{u.password=e?"":null}})),B.value&&_(z,{label:"输入密码"},_(A,{disabled:!B.value,placeholder:"",type:"password",value:u.password,inputProps:{name:"note-password",autocapitalize:"off",autocomplete:"new-password"},onInput:e=>{u.password=e}})),_(z,{label:"多久之后公开",labelWidth:"50%",labelAlign:"right",labelPlacement:"left"},_(V,{type:"datetime",isDateDisabled:e=>+new Date(e)-+new Date<0,placeholder:"选择时间",value:u.secret,onUpdateValue:e=>{u.secret=e?new Date(e):null}},{footer:()=>{const e=new Date;return _(T,null,_(O,{round:!0,type:"default",size:"small",onClick:()=>{u.secret=I(e,{days:1})}},"一天后"),_(O,{round:!0,type:"default",size:"small",onClick:()=>{u.secret=I(e,{weeks:1})}},"一周后"),_(O,{round:!0,type:"default",size:"small",onClick:()=>{u.secret=I(e,{days:14})}},"半个月后"),_(O,{round:!0,type:"default",size:"small",onClick:()=>{u.secret=I(e,{months:1})}},"一个月后"))}})),_(z,{label:"隐藏",labelWidth:"50%",labelAlign:"right",labelPlacement:"left"},_($,{value:u.hide,onUpdateValue:e=>{u.hide=e}})),_(z,{label:"是否存在回忆, 日后需要重温?",labelAlign:"right",labelPlacement:"left",labelWidth:"50%"},_($,{value:u.hasMemory,onUpdateValue:e=>{u.hasMemory=e}})),_(z,{label:"音乐 (网易云 ID)"},_(F,{value:u.music.map((e=>e.id)),onUpdateValue:e=>{u.music=e.map((e=>({type:"netease",id:e})))}}))))))}})),he=c({props:{onChange:{type:Function,required:!0}},setup(e){const t=S(),a=b(!1),l=async()=>{if(navigator.geolocation)try{const t=await new Promise(((e,t)=>{navigator.geolocation.getCurrentPosition((t=>{a.value=!0,e(t),a.value=!1}),(e=>{a.value=!1,t(e)}))})),{coords:{latitude:l,longitude:o}}=t,n=[o,l],s=await fetch("https://restapi.amap.com/v3/geocode/regeo?key="+X.amapKey+"&location="+n.join(",")),r=J(await s.json(),{deep:!0});e.onChange(r.regeocode,n)}catch(l){t.error("定位权限未打开")}else t.error("浏览器不支持定位")};return()=>_(O,{ghost:!0,round:!0,type:"primary",onClick:l,loading:a.value},{icon:()=>_(N,null,_(ue,null)),default:()=>"定位"})}}),ye=c({props:{placeholder:{type:String,default:""},onChange:{type:Function,required:!0}},setup(e){S();const t=b(!1),a=b(!1),l=b(""),o=b([]);let n;return x((()=>l.value),W((async e=>{t.value=!0;const a=await(async e=>{const t=new URLSearchParams([["key",X.amapKey],["keywords",e.replace(/\s/g,"|")]]),a=await fetch("https://restapi.amap.com/v3/place/text?"+t.toString());return await a.json()})(e);o.value=[],a.pois.forEach((e=>{const t=e.cityname+e.adname+e.address+e.name,[a,l]=e.location.split(",").map(Number);o.value.push({key:e.cityname,label:t,value:JSON.stringify([t,{latitude:l,longitude:a}])})})),t.value=!1}),400,{trailing:!0,leading:!0})),()=>_(q,null,_(O,{ghost:!0,round:!0,onClick:()=>{a.value=!0}},{icon:()=>_(N,null,_(se,null)),default:()=>"自定义"}),_(E,{show:a.value,onUpdateShow:e=>{a.value=e}},_(B,{class:"modal-card sm",bordered:!1,closable:!0,onClose:()=>{a.value=!1},title:"搜索关键字查找地点"},{default:()=>_(q,null,_(D,{labelPlacement:"top"},_(z,{label:"搜索地点"},_(R,{placeholder:e.placeholder||"",onSelect:e=>{n=e},options:o.value,loading:t.value,"onUpdate:value":e=>{l.value=e},value:l.value}))),_(T,{justify:"end"},_(O,{round:!0,type:"primary",onClick:()=>{const t=JSON.parse(n);e.onChange.apply(this,t),a.value=!1},disabled:t.value},"确定")))})))}});export default we;
//# sourceMappingURL=write-588c44b3-2_19_59.js.map
