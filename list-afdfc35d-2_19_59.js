import{A as e}from"./Add12Filled-e850f595-2_19_59.js";import{D as t}from"./Delete16Regular-af8ac10e-2_19_59.js";import{T as a}from"./index-348633d5-2_19_59.js";import{E as r}from"./edit-column-73bc48f1-2_19_59.js";import{R as i}from"./relative-time-b7c52aa8-2_19_59.js";import{R as s,u as o,C as l,a as d}from"./index-2_19_59.js";import{u as n}from"./use-table-917c3adc-2_19_59.js";import{d as c,B as u,aE as p,aa as g,w as m,o as y,k as f,aP as v,h as w,aQ as h,aR as _,aS as k,J as x,G as O,F as P}from"./vendor-a3bf3ad0-2_19_59.js";import{H as b}from"./rounded-button-00a9564c-2_19_59.js";const j=c({name:"PostList",setup(){const{loading:j,checkedRowKeys:T,data:D,pager:B,sortProps:R,fetchDataFn:C}=n(((e,t)=>async(a=z.query.page||1,r=20)=>{const i=await s.api.posts.get({params:{page:a,size:r,select:"title _id id created modified categoryId copyright tags",...R.sortBy?{sortBy:R.sortBy,sortOrder:R.sortOrder}:{}}});e.value=i.data,t.value=i.page})),F=u(),A=p(),z=g(),I=C;m((()=>z.query.page),(async e=>{await I(e)}));const S=o(l);y((async()=>{await I(),await S.fetch()}));const U=c({setup(){const e=f((()=>{var e;return(null==(e=S.data.value)?void 0:e.map((e=>({label:e.name,value:e.id}))))||[]})),t=v([{type:"selection",options:["none","all"]},{title:"标题",sortOrder:!1,sorter:"default",key:"title",width:200,ellipsis:!0,render:e=>w(_,{to:"/posts/edit?id="+e.id},e.title)},{title:"分类",sortOrder:!1,sorter:"default",key:"category",width:80,ellipsis:!0,filterOptions:e,filter:!0,render(e){var t,a,i;return S.map.value?w(r,{initialValue:null!=(a=null==(t=S.map.value.get(e.categoryId))?void 0:t.name)?a:"",onSubmit:async e=>{F.info("TODO")},type:"select",options:(null==(i=S.data.value)?void 0:i.map((e=>({label:e.name,value:e.id,key:e.id}))))||[]}):""}},{title:"创建于",width:100,key:"created",sortOrder:"descend",sorter:"default",render:e=>w(i,{time:e.created})},{title:"修改于",key:"modified",sorter:"default",sortOrder:!1,width:100,render:e=>w(i,{time:e.modified})},{title:"操作",fixed:"right",width:60,key:"id",render:e=>w(O,null,w(k,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await s.api.posts(e.id).delete(),F.success("删除成功"),await I(B.value.currentPage)}},{trigger:()=>w(x,{text:!0,type:"error",size:"tiny"},"移除"),default:()=>w("span",{style:{maxWidth:"12rem"}},"确定要删除 ",e.title," ?")}))}]);return()=>w(a,{loading:j.value,columns:t,data:D,nTableProps:{onUpdateFilters:async(e,t)=>{if(e&&e.category&&Array.isArray(e.category)){if(!e.category.length)return void(await I());const t=e.category.join(",");let{data:a}=await s.api.categories.get({params:{ids:t}});a=a.map((e=>e.category.children.map((t=>({...h(e.category,["children","id","id"]),...t,categoryId:e.category.id}))))).sort(((e,t)=>new Date(e).getTime()-new Date(t).getTime())).flat(),D.value=a,B.value={currentPage:1,total:1,size:0,hasNextPage:!1,hasPrevPage:!1,totalPage:1}}}},onFetchData:I,pager:B,onUpdateCheckedRowKeys:e=>{T.value=e},onUpdateSorter:async e=>{R.sortBy=e.sortBy,R.sortOrder=e.sortOrder}})}});return()=>w(d,null,{actions:()=>w(P,null,w(b,{variant:"error",disabled:0==T.value.length,onClick:()=>{A.warning({title:"警告",content:"你确定要删除？",positiveText:"确定",negativeText:"不确定",onPositiveClick:async()=>{for(const e of T.value)await s.api.posts(e).delete();T.value.length=0,F.success("删除成功"),await I()}})},icon:w(t,null)}),w(b,{to:"/posts/edit",icon:w(e,null)})),default:()=>w(U,null)})}});export{j as ManagePostListView};
//# sourceMappingURL=list-afdfc35d-2_19_59.js.map
