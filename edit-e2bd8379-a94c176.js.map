{"version":3,"file":"edit-e2bd8379-a94c176.js","sources":["../src/views/manage-project/edit.tsx"],"sourcesContent":["import TelegramPlane from '@vicons/fa/es/TelegramPlane'\nimport { HeaderActionButton } from 'components/button/rounded-button'\nimport { MonacoEditor } from 'components/editor/monaco'\nimport { useParsePayloadIntoData } from 'hooks/use-parse-payload'\nimport { ContentLayout } from 'layouts/content'\nimport { isString, transform } from 'lodash-es'\nimport { ProjectModel } from 'models/project'\nimport { NDynamicTags, NForm, NFormItem, NInput } from 'naive-ui'\nimport { RouteName } from 'router/name'\nimport { RESTManager } from 'utils'\nimport { computed, defineComponent, onMounted, reactive, toRaw } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\ntype ProjectReactiveType = {\n  name: string\n  previewUrl: string\n  docUrl: string\n  projectUrl: string\n  images: string[]\n  description: string\n  avatar: string\n  text: string\n}\n\nconst EditProjectView = defineComponent({\n  setup() {\n    const route = useRoute()\n    const router = useRouter()\n\n    const resetReactive: () => ProjectReactiveType = () => ({\n      name: '',\n      previewUrl: '',\n      docUrl: '',\n      projectUrl: '',\n      images: [],\n      description: '',\n      avatar: '',\n      text: '',\n    })\n\n    const parsePayloadIntoReactiveData = (payload: ProjectModel) =>\n      useParsePayloadIntoData(data)(payload)\n    const data = reactive<ProjectReactiveType>(resetReactive())\n    const id = computed(() => route.query.id)\n\n    onMounted(async () => {\n      const $id = id.value\n      if ($id && typeof $id == 'string') {\n        const payload = (await RESTManager.api.projects($id).get({})) as any\n\n        const data = payload.data\n        parsePayloadIntoReactiveData(data as ProjectModel)\n      }\n    })\n\n    const handleSubmit = async () => {\n      const parseDataToPayload = (): { [key in keyof ProjectModel]?: any } => {\n        try {\n          if (!data.text || data.text.trim().length == 0) {\n            throw '内容为空'\n          }\n\n          return {\n            ...transform(\n              toRaw(data),\n              (res, i, k) => (\n                (res[k] =\n                  typeof i == 'undefined'\n                    ? null\n                    : typeof i == 'string' && i.length == 0\n                    ? ''\n                    : i),\n                res\n              ),\n            ),\n            text: data.text.trim(),\n          }\n        } catch (e) {\n          message.error(e as any)\n\n          throw e\n        }\n      }\n      if (id.value) {\n        // update\n        if (!isString(id.value)) {\n          return\n        }\n        const $id = id.value as string\n        await RESTManager.api.projects($id).put({\n          data: parseDataToPayload(),\n        })\n        message.success('修改成功')\n      } else {\n        // create\n        await RESTManager.api.projects.post({\n          data: parseDataToPayload(),\n        })\n        message.success('发布成功')\n      }\n\n      router.push({ name: RouteName.ListProject })\n    }\n\n    return () => (\n      <ContentLayout\n        actionsElement={\n          <Fragment>\n            <HeaderActionButton\n              variant=\"primary\"\n              onClick={handleSubmit}\n              icon={<TelegramPlane></TelegramPlane>}\n            ></HeaderActionButton>\n          </Fragment>\n        }\n      >\n        <NForm>\n          <NFormItem\n            label=\"项目名称\"\n            required\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NInput\n              autofocus\n              placeholder=\"\"\n              value={data.name}\n              onInput={(e) => void (data.name = e)}\n            ></NInput>\n          </NFormItem>\n\n          <NFormItem\n            label=\"文档地址\"\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NInput\n              placeholder=\"\"\n              value={data.docUrl}\n              onInput={(e) => void (data.docUrl = e)}\n            ></NInput>\n          </NFormItem>\n\n          <NFormItem\n            label=\"预览地址\"\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NInput\n              placeholder=\"\"\n              value={data.previewUrl}\n              onInput={(e) => void (data.previewUrl = e)}\n            ></NInput>\n          </NFormItem>\n\n          <NFormItem\n            label=\"项目地址\"\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NInput\n              placeholder=\"\"\n              value={data.projectUrl}\n              onInput={(e) => void (data.projectUrl = e)}\n            ></NInput>\n          </NFormItem>\n\n          <NFormItem\n            label=\"项目描述\"\n            required\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NInput\n              placeholder=\"\"\n              value={data.description}\n              onInput={(e) => void (data.description = e)}\n            ></NInput>\n          </NFormItem>\n\n          <NFormItem\n            label=\"项目图标\"\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NInput\n              placeholder=\"\"\n              value={data.avatar}\n              onInput={(e) => void (data.avatar = e)}\n            ></NInput>\n          </NFormItem>\n\n          <NFormItem\n            label=\"项目图标\"\n            labelPlacement=\"left\"\n            labelStyle={{ width: '6rem' }}\n          >\n            <NDynamicTags\n              value={data.images}\n              onUpdateValue={(e) => void (data.images = e)}\n            ></NDynamicTags>\n          </NFormItem>\n\n          <NFormItem label=\"正文\" required>\n            <MonacoEditor\n              onChange={(e) => void (data.text = e)}\n              text={data.text}\n              class=\"h-40 w-full\"\n              unSaveConfirm={false}\n            />\n          </NFormItem>\n        </NForm>\n      </ContentLayout>\n    )\n  },\n})\n\nexport default EditProjectView\n"],"names":["EditProjectView","defineComponent","setup","route","useRoute","router","useRouter","data","reactive","name","previewUrl","docUrl","projectUrl","images","description","avatar","text","id","computed","query","async","$id","value","payload","useParsePayloadIntoData","RESTManager","api","projects","get","handleSubmit","parseDataToPayload","trim","length","transform","toRaw","res","i","k","e","error","isString","put","success","post","push","RouteName","ListProject","ContentLayout","actionsElement","Fragment","HeaderActionButton","variant","onClick","icon","TelegramPlane","NForm","NFormItem","label","required","labelPlacement","labelStyle","width","NInput","autofocus","placeholder","onInput","NDynamicTags","onUpdateValue","MonacoEditor","onChange","class","unSaveConfirm"],"mappings":"qbAuBMA,EAAkBC,EAAgB,CACtCC,cACQC,EAAQC,IACRC,EAASC,IAeTC,EAAOC,GAZXC,KAAM,GACNC,WAAY,GACZC,OAAQ,GACRC,WAAY,GACZC,OAAQ,GACRC,YAAa,GACbC,OAAQ,GACRC,KAAM,KAMFC,EAAKC,GAAS,IAAMf,EAAMgB,MAAMF,QAE5BG,gBACFC,EAAMJ,EAAGK,SACXD,GAAqB,iBAAPA,EAAiB,CAPA,CAACE,IACpCC,EAAwBjB,EAAxBiB,CAA8BD,YAOLE,EAAYC,IAAIC,SAASN,GAAKO,IAAI,KAEpCrB,gBAKnBsB,EAAeT,gBACbU,EAAqB,aAElBvB,EAAKS,MAAmC,GAA3BT,EAAKS,KAAKe,OAAOC,YAC3B,aAGD,IACFC,EACDC,EAAM3B,IACN,CAAC4B,EAAKC,EAAGC,OACFA,QACS,IAALD,EACH,KACY,iBAALA,GAA6B,GAAZA,EAAEJ,OAC1B,GACAI,EACND,KAGJnB,KAAMT,EAAKS,KAAKe,cAEXO,iBACCC,MAAMD,GAERA,OAGNrB,EAAGK,MAAO,KAEPkB,EAASvB,EAAGK,oBAGXD,EAAMJ,EAAGK,YACTG,EAAYC,IAAIC,SAASN,GAAKoB,IAAI,CACtClC,KAAMuB,cAEAY,QAAQ,mBAGVjB,EAAYC,IAAIC,SAASgB,KAAK,CAClCpC,KAAMuB,cAEAY,QAAQ,UAGXE,KAAK,CAAEnC,KAAMoC,EAAUC,qBAGzB,MACJC,EAAD,CACEC,iBACGC,EAAD,OACGC,EAAD,CACEC,QAAQ,UACRC,QAASvB,EACTwB,OAAOC,EAAD,YAKXC,EAAD,OACGC,EAAD,CACEC,MAAM,OACNC,UAAQ,EACRC,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBC,EAAD,CACEC,WAAS,EACTC,YAAY,GACZ1C,MAAOf,EAAKE,KACZwD,QAAU3B,MAAiB7B,KAAO6B,QAIrCkB,EAAD,CACEC,MAAM,OACNE,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBC,EAAD,CACEE,YAAY,GACZ1C,MAAOf,EAAKI,OACZsD,QAAU3B,MAAiB3B,OAAS2B,QAIvCkB,EAAD,CACEC,MAAM,OACNE,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBC,EAAD,CACEE,YAAY,GACZ1C,MAAOf,EAAKG,WACZuD,QAAU3B,MAAiB5B,WAAa4B,QAI3CkB,EAAD,CACEC,MAAM,OACNE,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBC,EAAD,CACEE,YAAY,GACZ1C,MAAOf,EAAKK,WACZqD,QAAU3B,MAAiB1B,WAAa0B,QAI3CkB,EAAD,CACEC,MAAM,OACNC,UAAQ,EACRC,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBC,EAAD,CACEE,YAAY,GACZ1C,MAAOf,EAAKO,YACZmD,QAAU3B,MAAiBxB,YAAcwB,QAI5CkB,EAAD,CACEC,MAAM,OACNE,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBC,EAAD,CACEE,YAAY,GACZ1C,MAAOf,EAAKQ,OACZkD,QAAU3B,MAAiBvB,OAASuB,QAIvCkB,EAAD,CACEC,MAAM,OACNE,eAAe,OACfC,WAAY,CAAEC,MAAO,WAEpBK,EAAD,CACE5C,MAAOf,EAAKM,OACZsD,cAAgB7B,MAAiBzB,OAASyB,QAI7CkB,EAAD,CAAWC,MAAM,KAAKC,UAAQ,KAC3BU,EAAD,CACEC,SAAW/B,MAAiBtB,KAAOsB,GACnCtB,KAAMT,EAAKS,KACXsD,MAAM,cACNC,eAAe"}